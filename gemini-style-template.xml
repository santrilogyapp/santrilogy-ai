<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html>
<html b:css='false' b:defaultwidgetversion='2' b:layoutsVersion='3' b:responsive='true' b:templateUrl='indie' b:templateVersion='1.3.3' expr:dir='data:blog.languageDirection' xmlns='http://www.w3.org/1999/xhtml' xmlns:b='http://www.google.com/2005/gml/b' xmlns:data='http://www.google.com/2005/gml/data' xmlns:expr='http://www.google.com/2005/gml/expr'>
<head>
    <meta content='width=device-width, initial-scale=1' name='viewport'/>
    <title><data:blog.pageTitle/> - Teman Diskusi Santrilogy</title>
    <meta content='Santrilogy AI adalah teman diskusi cerdas yang sangat cakap, cerdas, dan menyenangkan. Berbasis Ahlussunnah wal Jamaah, Fiqih Mazhab Syafii, Akidah Asyari-Maturidi, dan Akhlak-Tasawuf Al-Ghazali. Mampu membantu dalam pendidikan, manajemen pendidikan, analisis data, teori konspirasi, hiburan, dan cerita puitis serta humoris.' name='description'/>

    <!-- Open Graph Tags -->
    <meta property="og:title" content="&lt;data:blog.pageTitle/&gt; - Santrilogy AI"/>
    <meta property="og:description" content="Santrilogy AI adalah teman diskusi cerdas yang sangat cakap, cerdas, dan menyenangkan. Berbasis Ahlussunnah wal Jamaah, Fiqih Mazhab Syafii, Akidah Asyari-Maturidi, dan Akhlak-Tasawuf Al-Ghazali."/>
    <meta property="og:image" content="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjiFUlubJOO9a_p8i5olSbpkP2QvkRnjQG48P72O4Ca5VcEExRJYBYDqLZvsECVxRZ8wSnaIAUOdUJ8IEYmVvMc86eRHBFJ9SNsG8H1yWuF1hGFgIpOnxzCIq8Moft1jnnVfs2a8JaB3663pl0fnGlLJ5ACUAIVuc_zU9vHMJ-WRgLIKWzUEclwxGYIAuqM/w320-h400/Biru%20Ungu%20Putih%20Modern%20Tips%20AI%20Carousel%20Instagram%20Post.jpg"/>
    <meta property="og:image:width" content="320"/>
    <meta property="og:image:height" content="400"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="&lt;data:blog.url/&gt;"/>
    <meta property="og:site_name" content="Santrilogy AI"/>

    <!-- Fonts: Premium Arabic + Latin - Using Google Fonts CDN (large files, not practical to store locally) -->
    <link href='https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&amp;family=Scheherazade+New:wght@400;500;600;700&amp;family=Amiri:wght@400;700&amp;family=Amiri+Quran&amp;family=Noto+Naskh+Arabic:wght@400;500;600;700&amp;family=JetBrains+Mono:wght@400;500&amp;family=Lora:wght@400;500;600;700&amp;display=swap' rel='stylesheet'/>

    <link href='/assets/css/highlight.js/11.9.0/github-dark.min.css' rel='stylesheet'/>

    <b:skin><![CDATA[
    /* ========================================
       DESIGN SYSTEM - SANTRILOGY AI
       ======================================== */

    :root {
        /* Primary Palette */
        --primary: #0d9488;
        --primary-light: #14b8a6;
        --primary-dark: #0f766e;
        --primary-subtle: rgba(13, 148, 136, 0.08);
        --primary-glow: rgba(13, 148, 136, 0.25);

        /* Surfaces */
        --bg-primary: #fafbfc;
        --bg-secondary: #ffffff;
        --bg-tertiary: #f1f5f9;
        --bg-elevated: #ffffff;
        --bg-glass: rgba(255, 255, 255, 0.8);

        /* Text Hierarchy */
        --text-primary: #0f172a;
        --text-secondary: #475569;
        --text-tertiary: #94a3b8;
        --text-inverse: #ffffff;
        --text-arabic: #1a1a2e;

        /* Borders & Shadows */
        --border-light: #e2e8f0;
        --border-medium: #cbd5e1;
        --shadow-xs: 0 1px 2px rgba(0,0,0,0.03);
        --shadow-sm: 0 1px 3px rgba(0,0,0,0.04), 0 1px 2px rgba(0,0,0,0.03);
        --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.05), 0 2px 4px -1px rgba(0,0,0,0.03);
        --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.05), 0 4px 6px -2px rgba(0,0,0,0.03);
        --shadow-xl: 0 20px 25px -5px rgba(0,0,0,0.05), 0 10px 10px -5px rgba(0,0,0,0.02);
        --shadow-glow: 0 0 40px var(--primary-glow);

        /* Code */
        --code-bg: #1e293b;
        --code-text: #e2e8f0;

        /* Typography */
        --font-sans: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
        --font-serif: 'Lora', Georgia, serif;
        --font-arabic: 'Scheherazade New', 'Amiri', 'Noto Naskh Arabic', serif;
        --font-arabic-quran: 'Amiri Quran', 'Scheherazade New', serif;
        --font-mono: 'JetBrains Mono', 'Fira Code', monospace;

        /* Sizing */
        --font-size-base: 15px;
        --font-size-arabic: 1.75rem;
        --line-height-arabic: 2.8;

        /* Radius */
        --radius-xs: 4px;
        --radius-sm: 8px;
        --radius-md: 12px;
        --radius-lg: 16px;
        --radius-xl: 24px;
        --radius-full: 9999px;

        /* Transitions */
        --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
        --transition-normal: 250ms cubic-bezier(0.4, 0, 0.2, 1);
        --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);

        /* Layout */
        --sidebar-width: 280px;
        --header-height: 60px;
        --max-chat-width: 800px;

        /* Special Colors */
        --gold: #d4a853;
        --gold-light: #f5e6c8;
        --gold-dark: #b8860b;
        --donation-bg: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
    }

    /* Dark Mode */
    [data-theme="dark"] {
        --bg-primary: #0a0f1a;
        --bg-secondary: #111827;
        --bg-tertiary: #1f2937;
        --bg-elevated: #1e293b;
        --bg-glass: rgba(17, 24, 39, 0.9);
        --text-primary: #f1f5f9;
        --text-secondary: #94a3b8;
        --text-tertiary: #64748b;
        --text-arabic: #f8fafc;
        --border-light: #1f2937;
        --border-medium: #374151;
        --primary-subtle: rgba(13, 148, 136, 0.15);
        --shadow-sm: 0 1px 3px rgba(0,0,0,0.2);
        --shadow-md: 0 4px 6px rgba(0,0,0,0.25);
        --shadow-lg: 0 10px 15px rgba(0,0,0,0.3);
        --gold-light: rgba(212, 168, 83, 0.15);
        --donation-bg: linear-gradient(135deg, rgba(251, 191, 36, 0.1) 0%, rgba(245, 158, 11, 0.15) 100%);
    }

    /* ========================================
       RESET & BASE
       ======================================== */

    *, *::before, *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    html {
        font-size: var(--font-size-base);
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        text-rendering: optimizeLegibility;
    }

    body {
        font-family: var(--font-sans);
        background: var(--bg-primary);
        color: var(--text-primary);
        line-height: 1.65;
        height: 100vh;
        overflow: hidden;
        transition: background var(--transition-normal), color var(--transition-normal);
    }

    /* ========================================
       LAYOUT
       ======================================== */

    .app-container {
        display: flex;
        height: 100vh;
        width: 100vw;
    }

    /* ========================================
       SIDEBAR
       ======================================== */

    .sidebar {
        width: var(--sidebar-width);
        background: var(--bg-secondary);
        border-right: 1px solid var(--border-light);
        display: flex;
        flex-direction: column;
        flex-shrink: 0;
        transition: transform var(--transition-normal);
        z-index: 100;
        box-shadow: inset -1px 0 0 rgba(0, 0, 0, 0.05);
    }

    .sidebar-header {
        padding: 16px;
        border-bottom: 1px solid var(--border-light);
    }

    .new-chat-btn {
        width: 100%;
        padding: 12px 16px;
        background: var(--bg-elevated);
        border: 1px solid var(--border-light);
        border-radius: var(--radius-md);
        color: var(--text-primary);
        font-weight: 500;
        font-size: 0.875rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: flex-start;
        gap: 10px;
        transition: all var(--transition-fast);
    }

    .new-chat-btn:hover {
        background: var(--bg-tertiary);
        color: var(--text-primary);
        border-color: var(--border-medium);
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
    }

    .new-chat-btn svg {
        margin-right: 8px;
    }

    .sidebar-nav {
        flex: 1;
        overflow-y: auto;
        padding: 12px;
    }

    .nav-section-title {
        font-size: 0.7rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: var(--text-tertiary);
        padding: 8px 12px 6px;
    }

    .nav-item {
        padding: 8px 12px;
        border-radius: var(--radius-md);
        cursor: pointer;
        font-size: 0.85rem;
        color: var(--text-secondary);
        display: flex;
        align-items: center;
        gap: 10px;
        transition: all var(--transition-fast);
        margin-bottom: 2px;
        position: relative;
    }

    .nav-item:hover {
        background: var(--bg-tertiary);
        color: var(--text-primary);
    }

    .nav-item.active {
        background: var(--primary-subtle);
        color: var(--primary);
        font-weight: 500;
    }

    .nav-item-text {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        padding-right: 20px;
    }

    .delete-session {
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        color: var(--text-tertiary);
        font-size: 16px;
        font-weight: bold;
        transition: all 0.2s;
        position: absolute;
        right: 10px;
    }

    .delete-session:hover {
        background: #fee2e2;
        color: #dc2626;
    }

    .nav-item {
        position: relative; /* Penting agar delete button positioning pas */
    }

    .sidebar-footer {
        padding: 12px;
        border-top: 1px solid var(--border-light);
    }

    .user-card {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 10px;
        border-radius: var(--radius-md);
        cursor: pointer;
        transition: background var(--transition-fast);
        border: 1px solid var(--border-light);
    }

    .user-card:hover {
        background: var(--bg-tertiary);
    }

    .user-avatar {
        width: 32px;
        height: 32px;
        border-radius: var(--radius-full);
        background: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 0.8rem;
        overflow: hidden;
    }

    .user-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: var(--radius-full);
    }

    .user-info {
        flex: 1;
        min-width: 0;
    }

    .user-name {
        font-weight: 500;
        font-size: 0.85rem;
        color: var(--text-primary);
    }

    .user-plan {
        font-size: 0.7rem;
        color: var(--text-tertiary);
    }

    /* ========================================
       MAIN CONTENT
       ======================================== */

    .main-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        min-width: 0;
        position: relative;
        background: var(--bg-primary);
    }

    .main-header {
        height: var(--header-height);
        padding: 0 16px 0 80px; /* Increased left padding for sidebar */
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-bottom: 1px solid var(--border-light);
        background: var(--bg-secondary);
        position: fixed;
   		top: 0;
   		left: 0;
    	right: 0;
    	z-index: 100; /* Increased z-index to ensure header stays on top */
    	transition: transform 0.3s ease, opacity 0.3s ease;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    }

    .main-header.hidden {
        transform: translateY(-100%);
        opacity: 0;
        pointer-events: none;
    }

    /* Ensure header doesn't interfere with content when visible */
    .main-header:not(.hidden) ~ .main-content .chat-area {
        padding-top: var(--header-height) !important;
    }

    /* For when header is hidden, ensure proper spacing */
    .chat-area.header-hidden {
        padding-top: 0;
    }


    .header-left {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .menu-toggle {
        display: none;
        width: 38px;
        height: 38px;
        border: none;
        background: transparent;
        border-radius: var(--radius-md);
        cursor: pointer;
        color: var(--text-secondary);
        transition: all var(--transition-fast);
    }

    .menu-toggle:hover {
        background: var(--bg-tertiary);
        color: var(--text-primary);
    }

    .brand-logo {
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 700;
        font-size: 1.1rem;
        color: var(--text-primary);
    }

    .brand-icon {
        width: 32px;
        height: 32px;
        background: linear-gradient(135deg, var(--primary), var(--primary-light));
        border-radius: var(--radius-sm);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
    }

    .header-right {
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .header-btn {
        width: 36px;
        height: 36px;
        border: none;
        background: transparent;
        border-radius: var(--radius-sm);
        cursor: pointer;
        color: var(--text-secondary);
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all var(--transition-fast);
    }

    .header-btn:hover {
        background: var(--bg-tertiary);
        color: var(--text-primary);
    }

    .login-btn {
        padding: 8px 16px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: var(--radius-md);
        font-weight: 500;
        font-size: 0.85rem;
        cursor: pointer;
        transition: all var(--transition-fast);
    }

    .login-btn:hover {
        background: var(--primary-dark);
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
    }

    /* ========================================
       CHAT AREA
       ======================================== */

    .chat-area {
        flex: 1;
        overflow-y: auto;
        scroll-behavior: auto; /* Manual scroll control */
		padding-top: var(--header-height);
    transition: padding-top 0.3s ease;
    }

	.chat-area.header-hidden {
    padding-top: 0;
}

    .chat-container {
        max-width: var(--max-chat-width);
        margin: 0 auto;
        padding: 24px 24px 200px;
    }

    /* ========================================
       WELCOME SCREEN
       ======================================== */

    .welcome-screen {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 65vh;
        text-align: center;
        animation: fadeUp 0.6s ease;
        padding: 0 20px;
    }

    .welcome-icon {
        width: 60px;
        height: 60px;
        background: var(--primary);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 24px;
        color: white;
    }

    @keyframes float {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-8px); }
    }

    .welcome-title {
        font-family: var(--font-sans);
        font-size: 2rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 16px;
        letter-spacing: -0.02em;
    }

    .welcome-subtitle {
        font-size: 1.1rem;
        color: var(--text-secondary);
        max-width: 500px;
        line-height: 1.6;
        margin-bottom: 40px;
    }

    .quick-prompts {
        display: grid;
        grid-template-columns: 1fr;
        gap: 12px;
        width: 100%;
        max-width: 500px;
    }

    @media (min-width: 640px) {
        .quick-prompts {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    .quick-prompt {
        padding: 16px;
        background: var(--bg-secondary);
        border: 1px solid var(--border-light);
        border-radius: var(--radius-lg);
        text-align: left;
        cursor: pointer;
        transition: all var(--transition-fast);
        display: flex;
        align-items: flex-start;
        gap: 12px;
    }

    .quick-prompt:hover {
        border-color: var(--primary);
        background: var(--bg-tertiary);
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
    }

    .quick-prompt-icon {
        font-size: 1.1rem;
        margin-top: 2px;
        flex-shrink: 0;
    }

    .quick-prompt-text {
        font-size: 0.9rem;
        color: var(--text-primary);
        line-height: 1.5;
        margin: 0;
    }

    /* ========================================
       MESSAGES
       ======================================== */

    .messages-container {
        display: none;
        flex-direction: column;
        gap: 28px;
    }

    .messages-container.active {
        display: flex !important;
    }

    .message {
        display: flex;
        gap: 16px;
        animation: messageIn 0.4s ease;
        padding: 20px 0;
        position: relative;
    }

    .message.user {
        flex-direction: row-reverse;
    }

    .message-avatar {
        width: 30px;
        height: 30px;
        border-radius: var(--radius-sm);
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: 600;
        min-width: 30px;
        min-height: 30px;
    }

    .message.assistant .message-avatar {
        background: var(--primary);
        color: white;
        border-radius: var(--radius-sm);
    }

    .message.user .message-avatar {
        background: var(--primary);
        color: white;
        border-radius: var(--radius-sm);
    }

    .message-content {
        flex: 1;
        max-width: calc(100% - 50px);
        min-width: 0;
        position: relative;
    }

    .message.user .message-content {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
    }

    .message-bubble {
        font-size: 0.95rem;
        line-height: 1.6;
        color: var(--text-primary);
    }

    .message.user .message-bubble {
        background: var(--primary);
        color: white;
        padding: 8px 12px;
        border-radius: var(--radius-lg) var(--radius-sm) var(--radius-sm) var(--radius-lg);
        display: inline-block;
        max-width: 85%;
    }

    .message.assistant .message-bubble {
        background: var(--bg-secondary);
        padding: 8px 12px;
        border-radius: var(--radius-sm) var(--radius-lg) var(--radius-lg) var(--radius-sm);
        display: inline-block;
        max-width: 85%;
    }

    .message-image {
        max-width: 100%;
        max-height: 280px;
        border-radius: var(--radius-md);
        margin-bottom: 10px;
        border: 1px solid var(--border-light);
    }

    /* ========================================
       AI MESSAGE FORMATTING - TYPOGRAPHY
       ======================================== */

    .message.assistant .message-bubble p {
        margin-bottom: 14px;
    }

    .message.assistant .message-bubble p:last-child {
        margin-bottom: 0;
    }

    .message.assistant .message-bubble strong {
        color: var(--text-primary);
        font-weight: 600;
    }

    .message.assistant .message-bubble em {
        font-style: italic;
        color: var(--text-secondary);
    }

    .message.assistant .message-bubble a {
        color: var(--primary);
        text-decoration: none;
        border-bottom: 1px solid transparent;
        transition: border-color var(--transition-fast);
    }

    .message.assistant .message-bubble a:hover {
        border-bottom-color: var(--primary);
    }

    /* Headings in AI response */
    .message.assistant .message-bubble h1,
    .message.assistant .message-bubble h2,
    .message.assistant .message-bubble h3,
    .message.assistant .message-bubble h4 {
        font-family: var(--font-serif);
        color: var(--text-primary);
        margin: 20px 0 12px 0;
        font-weight: 600;
        letter-spacing: -0.01em;
    }

    .message.assistant .message-bubble h1 { font-size: 1.4rem; }
    .message.assistant .message-bubble h2 { font-size: 1.25rem; }
    .message.assistant .message-bubble h3 { font-size: 1.1rem; }
    .message.assistant .message-bubble h4 { font-size: 1rem; }

    /* ========================================
       ARABIC TEXT - ELEGANT TYPOGRAPHY
       ======================================== */

    .arabic-block {
        font-family: var(--font-arabic);
        font-size: var(--font-size-arabic);
        line-height: var(--line-height-arabic);
        direction: rtl;
        text-align: right;
        padding: 24px 28px;
        margin: 20px 0;
        background: linear-gradient(135deg, var(--gold-light) 0%, rgba(212, 168, 83, 0.08) 100%);
        border-radius: var(--radius-lg);
        border-right: 4px solid var(--gold);
        color: var(--text-arabic);
        position: relative;
        overflow: hidden;
    }

    .arabic-block::before {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 100px;
        height: 100px;
        background: radial-gradient(circle at top right, rgba(212, 168, 83, 0.15), transparent 70%);
        pointer-events: none;
    }

    /* Quran verses - special styling */
    .arabic-quran {
        font-family: var(--font-arabic-quran);
        font-size: 2rem;
        line-height: 3;
        padding: 28px 32px;
        background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
        border-right: 4px solid var(--primary);
        text-align: center;
    }

    [data-theme="dark"] .arabic-quran {
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.08) 0%, rgba(5, 150, 105, 0.12) 100%);
    }

    /* Inline Arabic */
    .arabic-inline {
        font-family: var(--font-arabic);
        font-size: 1.3rem;
        line-height: 2;
        direction: rtl;
        display: inline;
        padding: 0 6px;
        color: var(--text-arabic);
    }

    /* Arabic with translation */
    .arabic-with-translation {
        margin: 20px 0;
        border-radius: var(--radius-lg);
        overflow: hidden;
        border: 1px solid var(--border-light);
    }

    .arabic-with-translation .arabic-text {
        font-family: var(--font-arabic);
        font-size: var(--font-size-arabic);
        line-height: var(--line-height-arabic);
        direction: rtl;
        text-align: center;
        padding: 24px;
        background: var(--gold-light);
        color: var(--text-arabic);
        border-bottom: 1px solid var(--border-light);
    }

    .arabic-with-translation .translation {
        padding: 16px 20px;
        background: var(--bg-secondary);
        font-style: italic;
        color: var(--text-secondary);
        font-size: 0.95rem;
        line-height: 1.7;
    }

    .arabic-with-translation .translation::before {
        content: '"';
        font-size: 1.5rem;
        color: var(--primary);
        margin-right: 4px;
    }

    .arabic-with-translation .translation::after {
        content: '"';
        font-size: 1.5rem;
        color: var(--primary);
        margin-left: 4px;
    }

    [data-theme="dark"] .arabic-block {
        background: linear-gradient(135deg, rgba(212, 168, 83, 0.1) 0%, rgba(212, 168, 83, 0.05) 100%);
    }

    /* ========================================
       CODE BLOCKS
       ======================================== */

    .code-block {
        position: relative;
        margin: 18px 0;
        border-radius: var(--radius-md);
        overflow: hidden;
        background: var(--code-bg);
        box-shadow: var(--shadow-sm);
    }

    .code-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 14px;
        background: rgba(0,0,0,0.25);
        border-bottom: 1px solid rgba(255,255,255,0.08);
    }

    .code-lang {
        font-size: 0.72rem;
        font-weight: 600;
        color: var(--text-tertiary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .code-lang::before {
        content: '';
        width: 8px;
        height: 8px;
        background: var(--primary);
        border-radius: 50%;
    }

    .copy-btn {
        display: flex;
        align-items: center;
        gap: 5px;
        padding: 5px 10px;
        background: rgba(255,255,255,0.08);
        border: none;
        border-radius: var(--radius-xs);
        color: var(--text-tertiary);
        font-size: 0.72rem;
        font-weight: 500;
        cursor: pointer;
        transition: all var(--transition-fast);
    }

    .copy-btn:hover {
        background: rgba(255,255,255,0.15);
        color: white;
    }

    .copy-btn.copied {
        background: var(--primary);
        color: white;
    }

    .code-block pre {
        margin: 0;
        padding: 16px;
        overflow-x: auto;
        font-family: var(--font-mono);
        font-size: 0.8rem;
        line-height: 1.6;
        color: var(--code-text);
    }

    .code-block code {
        font-family: inherit;
        background: none;
        padding: 0;
    }

    /* Inline code */
    .message.assistant .message-bubble code:not(pre code) {
        background: var(--primary-subtle);
        color: var(--primary-dark);
        padding: 2px 7px;
        border-radius: var(--radius-xs);
        font-family: var(--font-mono);
        font-size: 0.85em;
        font-weight: 500;
    }

    [data-theme="dark"] .message.assistant .message-bubble code:not(pre code) {
        color: var(--primary-light);
    }

    /* ========================================
       LISTS
       ======================================== */

    .message.assistant .message-bubble ul,
    .message.assistant .message-bubble ol {
        margin: 14px 0;
        padding-left: 22px;
    }

    .message.assistant .message-bubble li {
        margin-bottom: 8px;
        padding-left: 6px;
    }

    .message.assistant .message-bubble li::marker {
        color: var(--primary);
    }

    /* ========================================
       BLOCKQUOTE
       ======================================== */

    .message.assistant .message-bubble blockquote {
        margin: 18px 0;
        padding: 16px 20px;
        background: var(--bg-tertiary);
        border-left: 4px solid var(--primary);
        border-radius: 0 var(--radius-md) var(--radius-md) 0;
        color: var(--text-secondary);
        font-style: italic;
        font-family: var(--font-serif);
    }

    /* ========================================
       TABLES
       ======================================== */

    .table-wrapper {
        overflow-x: auto;
        margin: 18px 0;
        border: 1px solid var(--border-light);
        border-radius: var(--radius-md);
    }

    .message.assistant .message-bubble table {
        width: 100%;
        border-collapse: collapse;
    }

    .message.assistant .message-bubble th,
    .message.assistant .message-bubble td {
        padding: 11px 14px;
        text-align: left;
        border-bottom: 1px solid var(--border-light);
    }

    .message.assistant .message-bubble th {
        background: var(--bg-tertiary);
        font-weight: 600;
    }

    .message.assistant .message-bubble tr:last-child td {
        border-bottom: none;
    }

    .message.assistant .message-bubble tr:hover td {
        background: var(--primary-subtle);
    }

    /* ========================================
       DIAGRAMS & CHARTS - MERMAID
       ======================================== */

    .diagram-wrapper {
        margin: 20px 0;
        border-radius: var(--radius-lg);
        overflow: hidden;
        border: 1px solid var(--border-light);
        background: var(--bg-secondary);
    }

    .diagram-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 16px;
        background: var(--bg-tertiary);
        border-bottom: 1px solid var(--border-light);
    }

    .diagram-title {
        font-size: 0.8rem;
        font-weight: 600;
        color: var(--text-secondary);
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .diagram-title svg {
        color: var(--primary);
    }

    .diagram-actions {
        display: flex;
        gap: 6px;
    }

    .diagram-btn {
        padding: 5px 10px;
        font-size: 0.72rem;
        background: var(--bg-secondary);
        border: 1px solid var(--border-light);
        border-radius: var(--radius-xs);
        color: var(--text-secondary);
        cursor: pointer;
        transition: all var(--transition-fast);
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .diagram-btn:hover {
        background: var(--primary-subtle);
        border-color: var(--primary);
        color: var(--primary);
    }

    .diagram-content {
        padding: 24px;
        overflow-x: auto;
        display: flex;
        justify-content: center;
        min-height: 200px;
        align-items: center;
    }

    .mermaid {
        text-align: center;
        width: 100%;
    }

    .mermaid svg {
        max-width: 100%;
        height: auto;
    }

    [data-theme="dark"] .mermaid {
        filter: invert(0.88) hue-rotate(180deg);
    }

    /* Fullscreen diagram */
    .diagram-fullscreen {
        position: fixed;
        inset: 0;
        z-index: 9999;
        background: var(--bg-primary);
        display: none;
        flex-direction: column;
    }

    .diagram-fullscreen.active {
        display: flex;
    }

    .diagram-fullscreen .diagram-header {
        flex-shrink: 0;
    }

    .diagram-fullscreen .diagram-content {
        flex: 1;
        overflow: auto;
        padding: 40px;
    }

    /* ========================================
       FLOWCHART / SCHEMA CUSTOM STYLING
       ======================================== */

    .schema-container {
        margin: 20px 0;
        padding: 24px;
        background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
        border-radius: var(--radius-lg);
        border: 1px solid var(--border-light);
    }

    .schema-title {
        font-family: var(--font-serif);
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 16px;
        text-align: center;
    }

    .schema-nodes {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        justify-content: center;
    }

    .schema-node {
        padding: 12px 20px;
        background: var(--bg-secondary);
        border: 2px solid var(--primary);
        border-radius: var(--radius-md);
        font-size: 0.9rem;
        font-weight: 500;
        color: var(--text-primary);
        position: relative;
        box-shadow: var(--shadow-sm);
        transition: all var(--transition-fast);
    }

    .schema-node:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
    }

    .schema-node.highlight {
        background: var(--primary);
        color: white;
    }

    .schema-arrow {
        display: flex;
        align-items: center;
        color: var(--primary);
        font-size: 1.2rem;
    }

    /* ========================================
       MESSAGE ACTIONS
       ======================================== */

    .message-actions {
        display: flex;
        gap: 4px;
        margin-top: 10px;
        opacity: 0;
        transition: opacity var(--transition-fast);
    }

    .message:hover .message-actions {
        opacity: 1;
    }

    .action-btn {
        width: 30px;
        height: 30px;
        border: none;
        background: var(--bg-tertiary);
        border-radius: var(--radius-xs);
        color: var(--text-tertiary);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all var(--transition-fast);
    }

    .action-btn:hover {
        background: var(--primary-subtle);
        color: var(--primary);
    }

    .action-btn.like-btn:hover {
        background: #dcfce7;
        color: #16a34a;
    }

    .action-btn.dislike-btn:hover {
        background: #fee2e2;
        color: #dc2626;
    }

    .action-btn.share-btn:hover {
        background: #dbeafe;
        color: #2563eb;
    }

    .action-btn.report-btn:hover {
        background: #fef3c7;
        color: #d97706;
    }

    .action-btn.active {
        background: var(--primary);
        color: white;
    }

    .action-btn.like-btn.active {
        background: #22c55e;
        color: white;
    }

    .action-btn.dislike-btn.active {
        background: #ef4444;
        color: white;
    }

    /* ========================================
       TYPING INDICATOR
       ======================================== */

    .typing-indicator {
        display: none;
        align-items: center;
        gap: 16px;
        padding: 20px 0;
    }

    .typing-indicator.active {
        display: flex;
    }

    .typing-avatar {
        width: 30px;
        height: 30px;
        background: var(--primary);
        border-radius: var(--radius-sm);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
    }

    .typing-dots {
        display: flex;
        gap: 6px;
        padding: 6px 8px;
        background: var(--bg-secondary);
        border-radius: var(--radius-lg);
    }

    .typing-dot {
        width: 6px;
        height: 6px;
        background: var(--text-tertiary);
        border-radius: var(--radius-full);
        animation: typingBounce 1.4s ease-in-out infinite;
    }

    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }

    /* ========================================
       DONATION CARD - COMPLETE STYLING
       ======================================== */

    .donation-card {
        background: var(--donation-bg);
        border: 1px solid rgba(251, 191, 36, 0.3);
        border-radius: var(--radius-lg);
        padding: 20px;
        margin: 18px 0;
        position: relative;
        overflow: hidden;
    }

    .donation-card::before {
        content: '';
        position: absolute;
        top: -30px;
        right: -30px;
        width: 100px;
        height: 100px;
        background: radial-gradient(circle, rgba(251, 191, 36, 0.2), transparent 70%);
        pointer-events: none;
    }

    .donation-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 12px;
    }

    .donation-icon {
        font-size: 1.5rem;
    }

    .donation-title {
        font-weight: 700;
        font-size: 1rem;
        color: #92400e;
    }

    [data-theme="dark"] .donation-title {
        color: #fbbf24;
    }

    .donation-text {
        font-size: 0.88rem;
        color: #78350f;
        line-height: 1.65;
        margin-bottom: 16px;
    }

    [data-theme="dark"] .donation-text {
        color: #fcd34d;
    }

    .donation-platforms {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 14px;
    }

    .donation-btn {
        padding: 8px 14px;
        background: white;
        border: 1px solid rgba(251, 191, 36, 0.4);
        border-radius: var(--radius-sm);
        font-size: 0.8rem;
        font-weight: 600;
        color: #92400e;
        cursor: pointer;
        transition: all var(--transition-fast);
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 6px;
    }

    .donation-btn:hover {
        background: #fef3c7;
        border-color: #fbbf24;
        transform: translateY(-1px);
        box-shadow: var(--shadow-sm);
    }

    [data-theme="dark"] .donation-btn {
        background: rgba(251, 191, 36, 0.1);
        color: #fbbf24;
    }

    [data-theme="dark"] .donation-btn:hover {
        background: rgba(251, 191, 36, 0.2);
    }

    /* Manual donation input */
    .donation-manual {
        display: flex;
        gap: 8px;
        margin-top: 12px;
        padding-top: 12px;
        border-top: 1px dashed rgba(251, 191, 36, 0.3);
    }

    .donation-input {
        flex: 1;
        padding: 10px 14px;
        border: 1px solid rgba(251, 191, 36, 0.3);
        border-radius: var(--radius-sm);
        font-size: 0.88rem;
        background: white;
        color: var(--text-primary);
    }

    [data-theme="dark"] .donation-input {
        background: rgba(0,0,0,0.2);
        color: var(--text-primary);
    }

    .donation-input::placeholder {
        color: var(--text-tertiary);
    }

    .donation-submit {
        padding: 10px 18px;
        background: var(--gold);
        border: none;
        border-radius: var(--radius-sm);
        font-weight: 600;
        font-size: 0.85rem;
        color: white;
        cursor: pointer;
        transition: all var(--transition-fast);
    }

    .donation-submit:hover {
        background: var(--gold-dark);
    }

    /* ========================================
       INPUT AREA
       ======================================== */

    .input-area {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        padding: 16px 24px 24px;
        background: var(--bg-primary);
        border-top: 1px solid var(--border-light);
        z-index: 60;
        backdrop-filter: blur(10px);
    }

    @media (max-width: 768px) {
        .input-area {
            padding: 12px 16px 20px;
        }
    }

    .input-container {
        max-width: var(--max-chat-width);
        margin: 0 auto;
        pointer-events: auto;
    }

    .input-box {
        display: flex;
        align-items: flex-end;
        gap: 8px;
        padding: 8px;
        background: var(--bg-secondary);
        border: 1px solid var(--border-light);
        border-radius: var(--radius-xl);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        transition: all var(--transition-fast);
        position: relative;
    }

    .input-box:focus-within {
        border-color: var(--primary);
        box-shadow: 0 0 0 2px var(--primary-subtle);
    }

    .input-actions {
        display: flex;
        gap: 2px;
    }

    .input-btn {
        width: 36px;
        height: 36px;
        border: none;
        background: transparent;
        border-radius: var(--radius-sm);
        color: var(--text-tertiary);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all var(--transition-fast);
    }

    .input-btn:hover {
        background: var(--bg-tertiary);
        color: var(--text-primary);
    }

    .input-field {
        flex: 1;
        border: none;
        background: transparent;
        font-family: var(--font-sans);
        font-size: 0.95rem;
        color: var(--text-primary);
        resize: none;
        max-height: 200px;
        line-height: 1.5;
        padding: 8px 12px;
        border-radius: var(--radius-lg);
        margin: 4px;
    }

    .input-field::placeholder {
        color: var(--text-tertiary);
    }

    .input-field:focus {
        outline: none;
    }

    .send-btn {
        width: 36px;
        height: 36px;
        border: none;
        background: var(--primary);
        border-radius: var(--radius-full);
        color: white;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all var(--transition-fast);
        align-self: flex-end;
        margin-bottom: 4px;
    }

    .send-btn.active {
        opacity: 1;
        background: var(--primary);
    }

    .send-btn:hover:not(:disabled) {
        background: var(--primary-dark);
        opacity: 0.9;
    }

    .send-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    /* Image Preview */
    .image-preview {
        display: none;
        margin-bottom: 10px;
        position: relative;
        width: fit-content;
    }

    .image-preview.active {
        display: block;
    }

    .preview-image {
        max-height: 100px;
        border-radius: var(--radius-md);
        border: 1px solid var(--border-light);
    }

    .preview-remove {
        position: absolute;
        top: -6px;
        right: -6px;
        width: 22px;
        height: 22px;
        border: none;
        background: var(--text-primary);
        color: var(--bg-primary);
        border-radius: var(--radius-full);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        font-weight: 600;
    }

    .input-hint {
        text-align: center;
        font-size: 0.72rem;
        color: var(--text-tertiary);
        margin-top: 10px;
    }

    /* ========================================
       MODALS
       ======================================== */

    .modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.5);
        backdrop-filter: blur(6px);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        opacity: 0;
        transition: opacity var(--transition-normal);
        padding: 20px;
    }

    .modal-overlay.active {
        display: flex;
        opacity: 1;
    }

    .modal {
        background: var(--bg-secondary);
        border-radius: var(--radius-xl);
        width: 100%;
        max-width: 400px;
        padding: 28px;
        box-shadow: var(--shadow-xl);
        transform: translateY(20px);
        transition: transform var(--transition-normal);
        position: relative;
        max-height: 90vh;
        overflow-y: auto;
    }

    .modal-overlay.active .modal {
        transform: translateY(0);
    }

    .modal-close {
        position: absolute;
        top: 14px;
        right: 14px;
        width: 30px;
        height: 30px;
        border: none;
        background: transparent;
        color: var(--text-tertiary);
        cursor: pointer;
        border-radius: var(--radius-sm);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.4rem;
        transition: all var(--transition-fast);
    }

    .modal-close:hover {
        background: var(--bg-tertiary);
        color: var(--text-primary);
    }

    .modal-header {
        text-align: center;
        margin-bottom: 22px;
    }

    .modal-icon {
        width: 56px;
        height: 56px;
        background: var(--primary-subtle);
        border-radius: var(--radius-lg);
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 14px;
        color: var(--primary);
    }

    .modal-title {
        font-family: var(--font-serif);
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 6px;
    }

    .modal-subtitle {
        font-size: 0.85rem;
        color: var(--text-secondary);
    }

    .modal-body {
        margin-bottom: 20px;
    }

    .form-group {
        margin-bottom: 14px;
    }

    .form-input {
        width: 100%;
        padding: 12px 14px;
        border: 1px solid var(--border-light);
        border-radius: var(--radius-md);
        font-family: var(--font-sans);
        font-size: 0.9rem;
        color: var(--text-primary);
        background: var(--bg-primary);
        transition: all var(--transition-fast);
    }

    .form-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px var(--primary-subtle);
    }

    .btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        width: 100%;
        padding: 12px 18px;
        border: none;
        border-radius: var(--radius-md);
        font-family: var(--font-sans);
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        transition: all var(--transition-fast);
    }

    .btn-primary {
        background: var(--primary);
        color: white;
    }

    .btn-primary:hover {
        background: var(--primary-dark);
    }

    .btn-outline {
        background: transparent;
        border: 1px solid var(--border-light);
        color: var(--text-primary);
    }

    .btn-outline:hover {
        background: var(--bg-tertiary);
    }

    .divider {
        display: flex;
        align-items: center;
        gap: 14px;
        margin: 18px 0;
        color: var(--text-tertiary);
        font-size: 0.8rem;
    }

    .divider::before, .divider::after {
        content: '';
        flex: 1;
        height: 1px;
        background: var(--border-light);
    }

    .auth-switch {
        text-align: center;
        font-size: 0.85rem;
        color: var(--text-secondary);
    }

    .auth-switch a {
        color: var(--primary);
        font-weight: 600;
        text-decoration: none;
        cursor: pointer;
    }

    /* Settings */
    .settings-section {
        margin-bottom: 20px;
    }

    .settings-label {
        font-size: 0.72rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: var(--text-tertiary);
        margin-bottom: 10px;
    }

    .theme-options {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
    }

    .theme-option {
        padding: 10px;
        border: 1px solid var(--border-light);
        border-radius: var(--radius-md);
        cursor: pointer;
        text-align: center;
        font-size: 0.85rem;
        color: var(--text-secondary);
        transition: all var(--transition-fast);
    }

    .theme-option:hover {
        border-color: var(--primary);
    }

    .theme-option.active {
        border-color: var(--primary);
        background: var(--primary-subtle);
        color: var(--primary);
    }

    .color-options {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
    }

    .color-option {
        width: 32px;
        height: 32px;
        border-radius: var(--radius-full);
        cursor: pointer;
        border: 3px solid transparent;
        transition: all var(--transition-fast);
    }

    .color-option:hover {
        transform: scale(1.1);
    }

    .color-option.active {
        border-color: var(--text-primary);
    }

    /* Toast */
    .toast-container {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 10000;
        display: flex;
        flex-direction: column;
        gap: 8px;
        pointer-events: none;
    }

    .toast {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 18px;
        background: var(--code-bg);
        color: white;
        border-radius: var(--radius-full);
        font-size: 0.85rem;
        font-weight: 500;
        box-shadow: var(--shadow-lg);
        opacity: 0;
        transform: translateY(-20px);
        transition: all var(--transition-normal);
    }

    .toast.show {
        opacity: 1;
        transform: translateY(0);
    }

    .toast.success {
        background: #059669;
    }

    .toast.error {
        background: #dc2626;
    }

    .toast.warning {
        background: #d97706;
    }

    /* ========================================
       RESPONSIVE
       ======================================== */

    @media (max-width: 900px) {
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            transform: translateX(-100%);
            box-shadow: var(--shadow-xl);
            z-index: 101;
        }

        .sidebar.active {
            transform: translateX(0);
        }

        .sidebar-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 100;
            display: none;
            backdrop-filter: blur(3px);
        }

        .sidebar-backdrop.active {
            display: block;
        }

        .menu-toggle {
            display: flex;
        }

        .quick-prompts {
            grid-template-columns: 1fr;
        }

        .main-header {
            padding-left: 60px; /* Adjust for mobile menu toggle */
        }
    }

    @media (max-width: 640px) {
       .chat-container {
        padding-bottom: 220px !important; /* Naikkan value ini */
        }

        .input-area {
            padding: 10px 12px 16px;
        }
/* Khusus iPhone yang punya 'Home Indicator' (garis bawah) */
@supports (padding-bottom: env(safe-area-inset-bottom)) {
    @media (max-width: 640px) {
        .input-area {
            padding-bottom: calc(30px + env(safe-area-inset-bottom));
        }
    }


        .welcome-title {
            font-size: 1.5rem;
        }

        .welcome-subtitle {
            font-size: 0.95rem;
        }

        .message {
            gap: 10px;
        }

        .message-content {
            max-width: 92%;
        }

        .arabic-block {
            padding: 18px 20px;
            font-size: 1.5rem;
        }

        .diagram-content {
            padding: 16px;
        }

        .donation-platforms {
            flex-direction: column;
        }

        .donation-btn {
            justify-content: center;
        }
    }

    /* ========================================
       ANIMATIONS
       ======================================== */

    @keyframes fadeUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes messageIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes typingBounce {
        0%, 60%, 100% { transform: translateY(0); }
        30% { transform: translateY(-5px); }
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
        width: 6px;
        height: 6px;
    }

    ::-webkit-scrollbar-track {
        background: transparent;
    }

    ::-webkit-scrollbar-thumb {
        background: var(--border-medium);
        border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
       background: var(--text-tertiary);
   }

    /* ========================================
       RESPONSIVE ENHANCEMENTS
       ======================================== */

    /* Extra Small Devices - Smartphones (<480px) */
    @media (max-width: 479px) {
        :root {
            --font-size-base: 14px; /* Slightly smaller text for very small screens */
        }

        .main-header {
            padding: 0 12px;
        }

        .brand-logo {
            font-size: 0.9rem;
            gap: 8px;
        }

        .brand-icon {
            width: 28px;
            height: 28px;
        }

        .chat-container {
            padding: 16px 16px 180px; /* Adjusted for very small screen */
        }

        .input-area {
            padding: 12px 12px 30px !important; /* Even more conservative on very small devices */
        }

        .input-box {
            padding: 8px 12px;
            gap: 8px;
        }

        .message {
            gap: 8px;
        }

        .message-avatar {
            width: 30px;
            height: 30px;
            font-size: 0.7rem;
        }
    }

    /* Small Devices - Smartphone Portrait (480px - 575px) */
    @media (min-width: 480px) and (max-width: 575px) {
        :root {
            --font-size-base: 14.5px;
        }

        .chat-container {
            padding: 20px 20px 200px;
        }

        .input-area {
            padding: 14px 14px 35px !important;
        }

        .input-box {
            padding: 9px 13px;
        }
    }

    /* Small Medium Devices - Smartphone Landscape (576px - 767px) */
    @media (min-width: 576px) and (max-width: 767px) {
        :root {
            --font-size-base: 15px;
        }

        .chat-container {
            padding: 22px 22px 220px;
        }

        .input-area {
            padding: 15px 15px 40px !important;
        }

        .message {
            gap: 12px;
        }
    }

    /* Tablet portrait (768px - 991px) */
    @media (min-width: 768px) and (max-width: 991px) {
        .sidebar {
            width: 250px; /* Slightly smaller sidebar for tablets */
        }

        .chat-container {
            padding: 24px 24px 160px; /* Less padding on sides for bigger screens */
        }

        .welcome-screen {
            padding: 0 20px;
        }

        .quick-prompts {
            grid-template-columns: repeat(2, 1fr);
            max-width: 500px;
        }

        .input-box {
            max-width: calc(100% - 30px); /* Account for safe areas */
        }
    }

    /* Tablet landscape / Small laptop (992px - 1199px) */
    @media (min-width: 992px) and (max-width: 1199px) {
        .sidebar {
            width: 260px; /* Slightly more generous for larger tablets */
        }

        .chat-container {
            max-width: 900px;
            padding: 26px 26px 140px;
        }

        .message-content {
            max-width: 85%;
        }
    }

    /* Large devices (1200px+) */
    @media (min-width: 1200px) {
        .chat-container {
            max-width: 1000px; /* Even more generous space for large screens */
            padding: 28px 28px 200px;
        }

        .message-content {
            max-width: 80%;
        }
    }

    /* High DPI Displays */
    @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
        * {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    }

    /* Safe Area for iOS devices */
    @supports (bottom: env(safe-area-inset-bottom)) {
        .input-area {
            padding-bottom: calc(20px + env(safe-area-inset-bottom));
        }
    }

    /* Vertical orientation adjustment */
    @media (orientation: portrait) and (max-height: 700px) {
        .chat-area {
            padding-bottom: 150px; /* More conservative on short portrait screens */
        }
    }

    @media (orientation: landscape) and (max-height: 500px) {
        .chat-area {
            padding-bottom: 120px; /* Adjust for short landscape screens */
        }
    }
   ]]></b:skin>
</head>
<body>
    <b:section id='main' showaddelement='no'/>

    <div class='toast-container' id='toastContainer'/>
    <div class='sidebar-backdrop' id='sidebarBackdrop'/>

    <!-- Auth Modal -->
    <div class='modal-overlay' id='authModal'>
        <div class='modal'>
            <button class='modal-close' id='authModalClose'>&#215;</button>
            <div class='modal-header'>
                <div class='modal-icon'>
                    <svg fill='none' height='26' stroke='currentColor' stroke-width='2' viewBox='0 0 24 24' width='26'><path d='M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2'/><circle cx='12' cy='7' r='4'/></svg>
                </div>
                <h2 class='modal-title' id='authModalTitle'>Selamat Datang</h2>
                <p class='modal-subtitle'>Masuk untuk menyimpan riwayat diskusi</p>
            </div>
            <div class='modal-body'>
                <div class='form-group'>
                    <input class='form-input' id='authEmail' placeholder='Email' type='email'/>
                </div>
                <div class='form-group'>
                    <input class='form-input' id='authPassword' placeholder='Password' type='password'/>
                </div>
                <button class='btn btn-primary' id='authSubmitBtn'>Masuk</button>
                <div class='divider'>atau</div>
                <button class='btn btn-outline' id='googleAuthBtn'>
                    <svg height='18' viewBox='0 0 24 24' width='18'><path d='M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z' fill='#4285F4'/><path d='M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z' fill='#34A853'/><path d='M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z' fill='#FBBC05'/><path d='M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z' fill='#EA4335'/></svg>
                    Lanjutkan dengan Google
                </button>
            </div>
            <div class='auth-switch'>
                <span id='authSwitchText'>Belum punya akun?</span>
                <a id='authSwitchLink'>Daftar</a>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class='modal-overlay' id='settingsModal'>
        <div class='modal'>
            <button class='modal-close' id='settingsModalClose'>&#215;</button>
            <div class='modal-header'>
                <div class='modal-icon'>
                    <svg fill='none' height='26' stroke='currentColor' stroke-width='2' viewBox='0 0 24 24' width='26'><circle cx='12' cy='12' r='3'/><path d='M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z'/></svg>
                </div>
                <h2 class='modal-title'>Pengaturan</h2>
                <p class='modal-subtitle'>Sesuaikan tampilan aplikasi</p>
            </div>
            <div class='modal-body'>
                <div class='settings-section'>
                    <div class='settings-label'>Tema</div>
                    <div class='theme-options'>
                        <div class='theme-option' data-theme='light' id='themeLightBtn'>&#9728;&#65039; Light</div>
                        <div class='theme-option' data-theme='dark' id='themeDarkBtn'> Dark</div>
                    </div>
                </div>
                <div class='settings-section'>
                    <div class='settings-label'>Warna Aksen</div>
                    <div class='color-options' id='colorOptions'>
                        <div class='color-option' data-color='#0d9488' style='background:#0d9488'/>
                        <div class='color-option' data-color='#2563eb' style='background:#2563eb'/>
                        <div class='color-option' data-color='#7c3aed' style='background:#7c3aed'/>
                        <div class='color-option' data-color='#db2777' style='background:#db2777'/>
                        <div class='color-option' data-color='#ea580c' style='background:#ea580c'/>
                        <div class='color-option' data-color='#16a34a' style='background:#16a34a'/>
                    </div>
                </div>
                <div class='settings-section'>
                    <div class='settings-label'>Ukuran Teks</div>
                    <input class='form-input' id='fontSizeSlider' max='18' min='13' style='padding:8px' type='range' value='15'/>
                </div>
            </div>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div class='modal-overlay' id='feedbackModal'>
        <div class='modal' style='text-align:center'>
            <button class='modal-close' id='feedbackModalClose'>&#215;</button>
            <div class='modal-header'>
                <div class='modal-icon' style='background:linear-gradient(135deg, #fbbf24, #f59e0b)'>
                    <svg fill='white' height='26' viewBox='0 0 24 24' width='26'><path d='M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z'/></svg>
                </div>
                <h2 class='modal-title'>Gimana diskusinya?</h2>
                <p class='modal-subtitle'>Kasih rating biar kami makin semangat!</p>
            </div>
            <div class='modal-body'>
                <div id='starRating' style='display:flex;justify-content:center;gap:8px;margin:18px 0'>
                    <span class='star' data-rating='1' style='font-size:30px;color:var(--border-medium);cursor:pointer;transition:0.2s'>&#9733;</span>
                    <span class='star' data-rating='2' style='font-size:30px;color:var(--border-medium);cursor:pointer;transition:0.2s'>&#9733;</span>
                    <span class='star' data-rating='3' style='font-size:30px;color:var(--border-medium);cursor:pointer;transition:0.2s'>&#9733;</span>
                    <span class='star' data-rating='4' style='font-size:30px;color:var(--border-medium);cursor:pointer;transition:0.2s'>&#9733;</span>
                    <span class='star' data-rating='5' style='font-size:30px;color:var(--border-medium);cursor:pointer;transition:0.2s'>&#9733;</span>
                </div>
                <button class='btn btn-outline' id='shareBtn'>
                    <svg fill='none' height='18' stroke='currentColor' stroke-width='2' viewBox='0 0 24 24' width='18'><circle cx='18' cy='5' r='3'/><circle cx='6' cy='12' r='3'/><circle cx='18' cy='19' r='3'/><line x1='8.59' x2='15.42' y1='13.51' y2='17.49'/><line x1='15.41' x2='8.59' y1='6.51' y2='10.49'/></svg>
                    Bagikan ke Teman
                </button>
            </div>
        </div>
    </div>

    <div class='app-container'>
        <!-- Sidebar -->
        <aside class='sidebar' id='sidebar'>
            <div class='sidebar-header'>
                <button class='new-chat-btn' id='newChatBtn'>
                    <svg fill='none' height='18' stroke='currentColor' stroke-width='2' viewBox='0 0 24 24' width='18'><line x1='12' x2='12' y1='5' y2='19'/><line x1='5' x2='19' y1='12' y2='12'/></svg>
                    Diskusi Baru
                </button>
            </div>
            <nav class='sidebar-nav'>
                <div class='nav-section-title'>Fitur Santri</div>
                <div class='nav-item' onclick='requestKitabTranslation()'>
                    <svg width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'>
                        <path d='M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z'/>
                        <path d='M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z'/>
                    </svg>
                    <span class='nav-item-text'>Terjemah Kitab</span>
                </div>
                <div class='nav-item' onclick='requestTasykil()'>
                    <svg width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'>
                        <circle cx='12' cy='12' r='10'/>
                        <path d='m12 6 4 6-4 6'/>
                        <path d='m8 6 4 6'/>
                    </svg>
                    <span class='nav-item-text'>Tasykil (Harakat)</span>
                </div>
                <div class='nav-item' onclick='requestIrobAnalysis()'>
                    <svg width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'>
                        <path d='M5 12h14'/>
                        <path d='M12 5v14'/>
                        <circle cx='12' cy='12' r='10'/>
                    </svg>
                    <span class='nav-item-text'>Bedah I'rob</span>
                </div>
                <div class='nav-item' onclick='requestRPPGeneration()'>
                    <svg width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'>
                        <path d='M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a5.04 5.04 0 0 0-1.4-6.6 4.96 4.96 0 0 0-6.57 0z'/>
                        <path d='M12 22.9l-6.2-6.2a5.04 5.04 0 0 1-1.4-6.6 4.96 4.96 0 0 1 6.57 0l6.2 6.2z'/>
                    </svg>
                    <span class='nav-item-text'>Generator RPP</span>
                </div>
                <div class='nav-item' onclick='requestMantiqTest()'>
                    <svg width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'>
                        <path d='M20 10c0-4.4-3.6-8-8-8s-8 3.6-8 8 3.6 8 8 8 8-3.6 8-8'/>
                        <path d='M12 16v-4'/>
                        <path d='M12 8h.01'/>
                    </svg>
                    <span class='nav-item-text'>Tes Logika (Mantiq)</span>
                </div>
                <div class='nav-section-title'>Riwayat Diskusi</div>
                <div id='historyList'>
                    <div style='padding:20px;text-align:center;color:var(--text-tertiary);font-size:0.85rem'>Belum ada riwayat diskusi</div>
                </div>
            </nav>
            <div class='sidebar-footer'>
                <div class='user-card' id='userCard'>
                    <div class='user-avatar' id='userAvatar'>?</div>
                    <div class='user-info'>
                        <div class='user-name' id='userName'>Guest</div>
                        <div class='user-plan' id='userPlan'>Klik untuk masuk</div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class='main-content'>
            <header class='main-header' id='mainHeader'>
                <div class='header-left'>
                    <button class='menu-toggle' id='menuToggle'>
                        <svg fill='none' height='24' stroke='currentColor' stroke-width='2' viewBox='0 0 24 24' width='24'><line x1='3' x2='21' y1='6' y2='6'/><line x1='3' x2='21' y1='12' y2='12'/><line x1='3' x2='21' y1='18' y2='18'/></svg>
                    </button>
                    <div class='brand-logo'>
                        <div class='brand-icon'>
                            <svg viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'><circle cx='12' cy='12' fill='#fff' r='2.197'/><path d='M21.63441 6.43671c-.70909-1.22723-2.41155-1.73142-4.79628-1.42354c-.30258.03942-.61354.09379-.92927.15769C15.00856 2.619 13.6066 1 12 1C10.39089 1 8.98713 2.62441 8.087 5.1834c-2.7384-.54268-4.90657-.15669-5.72186 1.25331C1.55256 7.84376 2.2947 9.90626 4.12193 12C2.2947 14.09374 1.55256 16.15624 2.3651 17.56329c.58143 1.00732 1.85 1.49542 3.52453 1.49542a11.47535 11.47535 0 0 0 2.197-.24305C8.98673 21.37518 10.39069 23 12 23c1.60658 0 3.00854-1.619 3.90884-4.17086c.31573.0639.62669.11827.92927.15769a10.18235 10.18235 0 0 0 1.297.088c1.70461 0 2.92647-.52028 3.49932-1.51151c.81254-1.407.07053-3.46955-1.75643-5.56329C21.70494 9.90626 22.447 7.84376 21.63441 6.43671ZM16.9851 6.13956a9.0809 9.0809 0 0 1 1.15965-.08046c1.26048 0 2.14979.32826 2.507.94617c.50426.87335-.06645 2.44138-1.55187 4.16777a20.50554 20.50554 0 0 0-2.30139-1.95281a19.9752 19.9752 0 0 0-.5471-2.93612C16.49539 6.23744 16.7503 6.17013 16.9851 6.13956Zm-3.07236 9.17417c-.64647.37332-1.28408.70346-1.90695.9935c-.63936-.29755-1.2812-.62534-1.919-.9935c-.64888-.37459-1.25525-.76326-1.81959-1.15917c-.06229-.6861-.09688-1.405-.09688-2.15456s.03459-1.46846.09688-2.15456c.56434-.39591 1.17071-.78458 1.81959-1.15917c.63487-.36648 1.27383-.69333 1.91024-.98982c.62668.29132 1.26511.61409 1.91573.98982c.64908.37472 1.25572.76346 1.82019 1.15958c.06222.686.09682 1.40477.09682 2.15415s-.0346 1.46813-.09682 2.15415C15.16846 14.55027 14.56182 14.939 13.91274 15.31373Zm1.628.3351a17.87565 17.87565 0 0 1-.39136 1.82408a18.46424 18.46424 0 0 1-1.76012-.58257c.36293-.18713.72713-.38337 1.092-.594C14.8457 16.086 15.1977 15.86928 15.54078 15.64883Zm-4.92407 1.24372A18.41329 18.41329 0 0 1 8.851 17.474a17.86018 17.86018 0 0 1-.39176-1.82549c.34328.22058.69541.43734 1.06.64787C9.88355 16.50677 10.24989 16.70348 10.61671 16.89255ZM7.07428 13.25036A18.3863 18.3863 0 0 1 5.67548 12a18.38878 18.38878 0 0 1 1.3988-1.25043c-.02005.41033-.03252.82636-.03252 1.25043S7.05423 12.8401 7.07428 13.25036Zm1.385-4.89886a17.86727 17.86727 0 0 1 .391-1.82227a18.22228 18.22228 0 0 1 1.76937.57681c-.36775.18947-.735.38659-1.10031.59759C9.15468 7.91416 8.80255 8.13092 8.45927 8.3515Zm4.93057-1.242a18.48842 18.48842 0 0 1 1.75958-.58237a17.87565 17.87565 0 0 1 .39136 1.82408c-.34308-.22045-.69508-.43715-1.05948-.64754C14.11663 7.4931 13.75263 7.29652 13.38984 7.10946ZM16.92577 10.75A18.40125 18.40125 0 0 1 18.324 12a18.38809 18.38809 0 0 1-1.39826 1.25c.02-.41013.03251-.826.03251-1.25S16.94581 11.1601 16.92577 10.75ZM12 2.12854c.99773 0 2.05613 1.23433 2.80746 3.31044a20.80159 20.80159 0 0 0-2.8094 1.01141A20.51935 20.51935 0 0 0 9.19055 5.44481C9.94208 3.36508 11.00163 2.12854 12 2.12854ZM3.34774 7.00527c.35133-.60825 1.2519-.93437 2.52043-.93437a10.26212 10.26212 0 0 1 1.88362.20148A19.96778 19.96778 0 0 0 7.20147 9.2205a20.48874 20.48874 0 0 0-2.30166 1.95288C3.41412 9.44692 2.84341 7.87869 3.34774 7.00527Zm0 9.98946c-.50433-.87342.06638-2.44165 1.55207-4.16811A20.50145 20.50145 0 0 0 7.20147 14.7795a19.94422 19.94422 0 0 0 .5518 2.95356C5.50578 18.162 3.85468 17.87245 3.34774 16.99473ZM12 21.87146c-.99866 0-2.05847-1.23708-2.81007-3.31775a20.44828 20.44828 0 0 0 2.81155-1.00255a20.80209 20.80209 0 0 0 2.806 1.00979C14.05615 20.63706 12.99775 21.87146 12 21.87146Zm8.65175-4.87673c-.45914.79277-1.79257 1.10923-3.66667.86571c-.2348-.03057-.48971-.09788-.73369-.14455a19.97619 19.97619 0 0 0 .5471-2.93619A20.50419 20.50419 0 0 0 19.0999 12.827C20.58532 14.55335 21.156 16.12138 20.65177 16.99473Z' fill='#fff'/><circle cx='-.5' cy='2' fill='#fff' r='1.5'><animateMotion dur='2s' path='M14.75 14.1471C12.2277 15.6034 9.69019 16.4332 7.6407 16.6145C5.54599 16.7998 4.15833 16.3018 3.62324 15.375C3.08815 14.4482 3.35067 12.9974 4.55852 11.276C5.74031 9.59178 7.72768 7.80915 10.25 6.35289C12.7723 4.89662 15.3098 4.06682 17.3593 3.88549C19.454 3.70016 20.8417 4.1982 21.3768 5.125C21.9118 6.0518 21.6493 7.50256 20.4415 9.22397C19.2597 10.9082 17.2723 12.6909 14.75 14.1471Z' repeatCount='indefinite'/></circle></svg>
                        </div>
                        <span>Santrilogy AI</span>
                    </div>
                </div>
                <div class='header-right'>
                    <button class='header-btn' id='newChatBtnHeader' title='New chat'>
                        <svg fill='none' stroke='currentColor' stroke-width='2' viewBox='0 0 24 24'><path d='M12 5v14M5 12h14'/></svg>
                    </button>
                    <button class='header-btn' id='settingsBtn' title='Pengaturan'>
                        <svg fill='none' height='20' stroke='currentColor' stroke-width='2' viewBox='0 0 24 24' width='20'><circle cx='12' cy='12' r='3'/><path d='M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z'/></svg>
                    </button>
                    <div id='authContainer'>
                        <button class='login-btn' id='loginBtn'>Masuk</button>
                    </div>
                </div>
            </header>

            <div class='chat-area' id='chatArea'>
                <div class='chat-container'>
                    <!-- Welcome Screen -->
                    <div class='welcome-screen' id='welcomeScreen'>
                        <div class='welcome-icon'>
                            <svg viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'><circle cx='12' cy='12' fill='#fff' r='2.197'/><path d='M21.63441 6.43671c-.70909-1.22723-2.41155-1.73142-4.79628-1.42354c-.30258.03942-.61354.09379-.92927.15769C15.00856 2.619 13.6066 1 12 1C10.39089 1 8.98713 2.62441 8.087 5.1834c-2.7384-.54268-4.90657-.15669-5.72186 1.25331C1.55256 7.84376 2.2947 9.90626 4.12193 12C2.2947 14.09374 1.55256 16.15624 2.3651 17.56329c.58143 1.00732 1.85 1.49542 3.52453 1.49542a11.47535 11.47535 0 0 0 2.197-.24305C8.98673 21.37518 10.39069 23 12 23c1.60658 0 3.00854-1.619 3.90884-4.17086c.31573.0639.62669.11827.92927.15769a10.18235 10.18235 0 0 0 1.297.088c1.70461 0 2.92647-.52028 3.49932-1.51151c.81254-1.407.07053-3.46955-1.75643-5.56329C21.70494 9.90626 22.447 7.84376 21.63441 6.43671ZM16.9851 6.13956a9.0809 9.0809 0 0 1 1.15965-.08046c1.26048 0 2.14979.32826 2.507.94617c.50426.87335-.06645 2.44138-1.55187 4.16777a20.50554 20.50554 0 0 0-2.30139-1.95281a19.9752 19.9752 0 0 0-.5471-2.93612C16.49539 6.23744 16.7503 6.17013 16.9851 6.13956Zm-3.07236 9.17417c-.64647.37332-1.28408.70346-1.90695.9935c-.63936-.29755-1.2812-.62534-1.919-.9935c-.64888-.37459-1.25525-.76326-1.81959-1.15917c-.06229-.6861-.09688-1.405-.09688-2.15456s.03459-1.46846.09688-2.15456c.56434-.39591 1.17071-.78458 1.81959-1.15917c.63487-.36648 1.27383-.69333 1.91024-.98982c.62668.29132 1.26511.61409 1.91573.98982c.64908.37472 1.25572.76346 1.82019 1.15958c.06222.686.09682 1.40477.09682 2.15415s-.0346 1.46813-.09682 2.15415C15.16846 14.55027 14.56182 14.939 13.91274 15.31373Zm1.628.3351a17.87565 17.87565 0 0 1-.39136 1.82408a18.46424 18.46424 0 0 1-1.76012-.58257c.36293-.18713.72713-.38337 1.092-.594C14.8457 16.086 15.1977 15.86928 15.54078 15.64883Zm-4.92407 1.24372A18.41329 18.41329 0 0 1 8.851 17.474a17.86018 17.86018 0 0 1-.39176-1.82549c.34328.22058.69541.43734 1.06.64787C9.88355 16.50677 10.24989 16.70348 10.61671 16.89255ZM7.07428 13.25036A18.3863 18.3863 0 0 1 5.67548 12a18.38878 18.38878 0 0 1 1.3988-1.25043c-.02005.41033-.03252.82636-.03252 1.25043S7.05423 12.8401 7.07428 13.25036Zm1.385-4.89886a17.86727 17.86727 0 0 1 .391-1.82227a18.22228 18.22228 0 0 1 1.76937.57681c-.36775.18947-.735.38659-1.10031.59759C9.15468 7.91416 8.80255 8.13092 8.45927 8.3515Zm4.93057-1.242a18.48842 18.48842 0 0 1 1.75958-.58237a17.87565 17.87565 0 0 1 .39136 1.82408c-.34308-.22045-.69508-.43715-1.05948-.64754C14.11663 7.4931 13.75263 7.29652 13.38984 7.10946ZM16.92577 10.75A18.40125 18.40125 0 0 1 18.324 12a18.38809 18.38809 0 0 1-1.39826 1.25c.02-.41013.03251-.826.03251-1.25S16.94581 11.1601 16.92577 10.75ZM12 2.12854c.99773 0 2.05613 1.23433 2.80746 3.31044a20.80159 20.80159 0 0 0-2.8094 1.01141A20.51935 20.51935 0 0 0 9.19055 5.44481C9.94208 3.36508 11.00163 2.12854 12 2.12854ZM3.34774 7.00527c.35133-.60825 1.2519-.93437 2.52043-.93437a10.26212 10.26212 0 0 1 1.88362.20148A19.96778 19.96778 0 0 0 7.20147 9.2205a20.48874 20.48874 0 0 0-2.30166 1.95288C3.41412 9.44692 2.84341 7.87869 3.34774 7.00527Zm0 9.98946c-.50433-.87342.06638-2.44165 1.55207-4.16811A20.50145 20.50145 0 0 0 7.20147 14.7795a19.94422 19.94422 0 0 0 .5518 2.95356C5.50578 18.162 3.85468 17.87245 3.34774 16.99473ZM12 21.87146c-.99866 0-2.05847-1.23708-2.81007-3.31775a20.44828 20.44828 0 0 0 2.81155-1.00255a20.80209 20.80209 0 0 0 2.806 1.00979C14.05615 20.63706 12.99775 21.87146 12 21.87146Zm8.65175-4.87673c-.45914.79277-1.79257 1.10923-3.66667.86571c-.2348-.03057-.48971-.09788-.73369-.14455a19.97619 19.97619 0 0 0 .5471-2.93619A20.50419 20.50419 0 0 0 19.0999 12.827C20.58532 14.55335 21.156 16.12138 20.65177 16.99473Z' fill='#fff'/><circle cx='-.5' cy='2' fill='#fff' r='1.5'><animateMotion dur='2s' path='M14.75 14.1471C12.2277 15.6034 9.69019 16.4332 7.6407 16.6145C5.54599 16.7998 4.15833 16.3018 3.62324 15.375C3.08815 14.4482 3.35067 12.9974 4.55852 11.276C5.74031 9.59178 7.72768 7.80915 10.25 6.35289C12.7723 4.89662 15.3098 4.06682 17.3593 3.88549C19.454 3.70016 20.8417 4.1982 21.3768 5.125C21.9118 6.0518 21.6493 7.50256 20.4415 9.22397C19.2597 10.9082 17.2723 12.6909 14.75 14.1471Z' repeatCount='indefinite'/></circle></svg>
                        </div>
                        <h1 class='welcome-title'>Assalamualaikum! </h1>
                        <p class='welcome-subtitle'>
                            Saya Santrilogy AI, teman diskusimu yang siap menemanimu belajar dan berdiskusi tentang apapun, mulai dari resume (khulashah) hasil belajarmu, terjemah teks arab, dan berbagai topik menarik lainnya.
                        </p>
                        <div class='quick-prompts' id='quickPrompts'>
                            <div class='quick-prompt' data-prompt='Saya ingin membuat RPP, bisakah kamu bantu saya?'>
                                <div class='quick-prompt-icon'></div>
                                <div class='quick-prompt-text'>Bikin RPP (Rencana Pelaksanaan Pembelajaran)</div>
                            </div>
                            <div class='quick-prompt' data-prompt='Saya ingin menganalisis data pendidikan, bisakah kamu bantu?'>
                                <div class='quick-prompt-icon'></div>
                                <div class='quick-prompt-text'>Analisis data pendidikan</div>
                            </div>
                            <div class='quick-prompt' data-prompt='Saya ingin membuat manajemen pendidikan, bisakah kamu bantu?'>
                                <div class='quick-prompt-icon'></div>
                                <div class='quick-prompt-text'>Manajemen pendidikan</div>
                            </div>
                            <div class='quick-prompt' data-prompt='Saya ingin berdiskusi tentang hukum islam'>
                                <div class='quick-prompt-icon'>&#9878;&#65039;</div>
                                <div class='quick-prompt-text'>Diskusi hukum islam</div>
                            </div>
                            <div class='quick-prompt' data-prompt='Saya ingin kamu bantu analisis data numerik'>
                                <div class='quick-prompt-icon'></div>
                                <div class='quick-prompt-text'>Analisis data numerik</div>
                            </div>
                            <div class='quick-prompt' data-prompt='Ceritakan dongeng yang puitis dan menginspirasi'>
                                <div class='quick-prompt-icon'></div>
                                <div class='quick-prompt-text'>Cerita puitis</div>
                            </div>
                            <div class='quick-prompt' data-prompt='Aku pengen cerita lucu atau humoris'>
                                <div class='quick-prompt-icon'></div>
                                <div class='quick-prompt-text'>Cerita humoris</div>
                            </div>
                            <div class='quick-prompt' data-prompt='Bicara tentang teori konspirasi dengan logis'>
                                <div class='quick-prompt-icon'></div>
                                <div class='quick-prompt-text'>Teori konspirasi</div>
                            </div>
                        </div>
                    </div>

                    <!-- Messages Container -->
                    <div class='messages-container' id='messagesContainer'/>

                    <!-- Typing Indicator -->
                    <div class='typing-indicator' id='typingIndicator'>
                        <div class='typing-avatar'>
                            <svg fill='none' height='16' stroke='currentColor' stroke-width='2' viewBox='0 0 24 24' width='16'><path d='M12 2L2 7l10 5 10-5-10-5z'/></svg>
                        </div>
                        <div class='typing-dots'>
                            <div class='typing-dot'/>
                            <div class='typing-dot'/>
                            <div class='typing-dot'/>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class='input-area'>
                <div class='input-container'>
                    <div class='image-preview' id='imagePreview'>
                        <img class='preview-image' id='previewImg' src=''/>
                        <button class='preview-remove' id='removeImageBtn'>&#215;</button>
                    </div>
                    <div class='input-box'>
                        <div class='input-actions'>
                            <input accept='image/*' id='fileInput' style='display:none' type='file'/>
                            <button class='input-btn' id='uploadBtn' title='Upload Gambar'>
                                <svg fill='none' height='20' stroke='currentColor' stroke-width='2' viewBox='0 0 24 24' width='20'><rect height='18' rx='2' ry='2' width='18' x='3' y='3'/><circle cx='8.5' cy='8.5' r='1.5'/><polyline points='21,15 16,10 5,21'/></svg>
                            </button>
                        </div>
                        <textarea class='input-field' id='inputField' placeholder='Ketik pesanmu di sini...' rows='1'/>
                        <button class='send-btn' id='sendBtn'>
                            <svg fill='currentColor' height='20' viewBox='0 0 24 24' width='20'><path d='M2.01 21L23 12 2.01 3 2 10l15 2-15 2z'/></svg>
                        </button>
                    </div>
                    <div class='input-hint'>Santrilogy AI dapat membuat kesalahan. Periksa informasi penting.</div>
                </div>
            </div>
        </main>
    </div>

    <!-- External Libraries -->
    <script src='/assets/js/marked/marked.min.js'/>
    <script src='/assets/js/mermaid/mermaid.min.js'/>
    <script src='/assets/js/highlight.js/highlight.min.js'/>

    <!-- Supabase Integration -->
    <script src="/assets/js/supabase/supabase-js@2.js"></script>

    <script>
    //<![CDATA[
    // ========== SUPABASE INTEGRATION ==========
    // Konfigurasi Supabase - Ganti dengan URL dan anon key Anda
    // Sebaiknya disimpan di environment variabel atau sistem yang aman
    const SUPABASE_URL = document.querySelector('meta[name="supabase-url"]')?.content || 'YOUR_SUPABASE_URL';
    const SUPABASE_ANON_KEY = document.querySelector('meta[name="supabase-anon-key"]')?.content || 'YOUR_SUPABASE_ANON_KEY';

    // Inisialisasi client Supabase
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Fungsi untuk mengatur konfigurasi Supabase dari luar (jika diperlukan)
    window.setSupabaseConfig = function(url, anonKey) {
        if (url && anonKey) {
            window.supabase = supabase.createClient(url, anonKey);
            return true;
        }
        return false;
    };

    // API Wrapper untuk Supabase
    var SantrilogyAPI = {
        // Fungsi autentikasi
        auth: {
            register: async function(email, password, userData = {}) {
                try {
                    const { data, error } = await supabase.auth.signUp({
                        email,
                        password,
                        options: {
                            data: {
                                username: userData.username || email.split('@')[0],
                                full_name: userData.full_name || userData.username || email.split('@')[0],
                                ...userData
                            }
                        }
                    });

                    if (error) throw error;

                    // Simpan data pengguna tambahan ke tabel users
                    if (data.user) {
                        await supabase
                            .from('users')
                            .insert([{
                                id: data.user.id,
                                email: data.user.email,
                                username: userData.username || email.split('@')[0],
                                full_name: userData.full_name || userData.username || email.split('@')[0],
                                avatar_url: userData.avatar_url || null
                            }]);
                    }

                    return { success: true, data };
                } catch (error) {
                    console.error('Registration error:', error);
                    return { success: false, error: error.message };
                }
            },

            login: async function(email, password) {
                try {
                    const { data, error } = await supabase.auth.signInWithPassword({
                        email,
                        password
                    });

                    if (error) throw error;

                    return { success: true, data };
                } catch (error) {
                    console.error('Login error:', error);
                    return { success: false, error: error.message };
                }
            },

            loginWithGoogle: async function() {
                try {
                    const { error } = await supabase.auth.signInWithOAuth({
                        provider: 'google',
                        options: {
                            redirectTo: window.location.origin
                        }
                    });

                    if (error) throw error;
                } catch (error) {
                    console.error('Google login error:', error);
                    return { success: false, error: error.message };
                }
            },

            logout: async function() {
                try {
                    const { error } = await supabase.auth.signOut();

                    if (error) throw error;

                    return { success: true };
                } catch (error) {
                    console.error('Logout error:', error);
                    return { success: false, error: error.message };
                }
            },

            getCurrentUser: async function() {
                try {
                    const { data: { user }, error } = await supabase.auth.getUser();

                    if (error) throw error;

                    return user;
                } catch (error) {
                    console.error('Get current user error:', error);
                    return null;
                }
            }
        },

        // Fungsi manajemen chat
        chat: {
            // Fungsi untuk membuat sesi percakapan baru
            createChatSession: async function(userId, title = 'New Chat') {
                try {
                    const { data, error } = await supabase
                        .from('chat_sessions')
                        .insert([{
                            user_id: userId,
                            title: title,
                            metadata: { created_with: 'santrilogy-ai' }
                        }])
                        .select()
                        .single();

                    if (error) throw error;

                    return { success: true, data };
                } catch (error) {
                    console.error('Create chat session error:', error);
                    return { success: false, error: error.message };
                }
            },

            // Fungsi untuk mendapatkan daftar sesi percakapan pengguna
            getUserChatSessions: async function(userId, limit = 50, offset = 0) {
                try {
                    const { data, error, count } = await supabase
                        .from('chat_sessions')
                        .select(`
                            id,
                            title,
                            created_at,
                            updated_at,
                            metadata
                        `, { count: 'exact' })
                        .eq('user_id', userId)
                        .order('updated_at', { ascending: false })
                        .range(offset, offset + limit - 1);

                    if (error) throw error;

                    // Ambil jumlah pesan untuk setiap sesi
                    const sessionIds = data.map(session => session.id);
                    if (sessionIds.length > 0) {
                        const { data: messageCounts, error: countError } = await supabase
                            .from('messages')
                            .select('session_id', { count: 'exact', groupedBy: 'session_id' })
                            .in('session_id', sessionIds);

                        if (!countError && messageCounts) {
                            data.forEach(session => {
                                const messageCountObj = messageCounts.find(mc => mc.session_id === session.id);
                                session.messageCount = messageCountObj ? messageCountObj.count : 0;
                            });
                        }
                    }

                    return { success: true, data, total: count };
                } catch (error) {
                    console.error('Get user chat sessions error:', error);
                    return { success: false, error: error.message };
                }
            },

            // Fungsi untuk mendapatkan pesan dalam sesi percakapan
            getChatMessages: async function(sessionId, userId, limit = 1000, offset = 0) {
                try {
                    const { data, error } = await supabase
                        .from('messages')
                        .select('*')
                        .eq('session_id', sessionId)
                        .eq('user_id', userId)
                        .order('created_at', { ascending: true })
                        .range(offset, offset + limit - 1);

                    if (error) throw error;

                    return { success: true, data };
                } catch (error) {
                    console.error('Get chat messages error:', error);
                    return { success: false, error: error.message };
                }
            },

            // Fungsi untuk menyimpan pesan baru
            saveMessage: async function(sessionId, userId, role, content, parentMessageId = null) {
                try {
                    // Perbarui waktu terakhir sesi diakses
                    await supabase
                        .from('chat_sessions')
                        .update({ updated_at: new Date().toISOString() })
                        .eq('id', sessionId)
                        .eq('user_id', userId);

                    const { data, error } = await supabase
                        .from('messages')
                        .insert([{
                            session_id: sessionId,
                            user_id: userId,
                            role: role, // 'user' atau 'assistant'
                            content: content,
                            parent_message_id: parentMessageId
                        }])
                        .select()
                        .single();

                    if (error) throw error;

                    return { success: true, data };
                } catch (error) {
                    console.error('Save message error:', error);
                    return { success: false, error: error.message };
                }
            },

            // Fungsi untuk menghapus sesi percakapan
            deleteChatSession: async function(sessionId, userId) {
                try {
                    const { error } = await supabase
                        .from('chat_sessions')
                        .delete()
                        .eq('id', sessionId)
                        .eq('user_id', userId);

                    if (error) throw error;

                    return { success: true };
                } catch (error) {
                    console.error('Delete chat session error:', error);
                    return { success: false, error: error.message };
                }
            }
        }
    };

    // Backend Santrilogy yang terintegrasi dengan Supabase
    var SantrilogyBackend = {
        // Kirim chat ke backend Supabase
        sendChat: async function(message, userId, sessionId) {
            try {
                // Dapatkan user saat ini
                const user = await SantrilogyAPI.auth.getCurrentUser();
                if (!user || user.id !== userId) {
                    throw new Error('User not authenticated');
                }

                // Simpan pesan pengguna ke database
                const userMessageResult = await SantrilogyAPI.chat.saveMessage(
                    sessionId,
                    userId,
                    'user',
                    message
                );

                if (!userMessageResult.success) {
                    throw new Error(userMessageResult.error);
                }

                // Integrasi dengan Google Generative AI
                // Dalam implementasi sebenarnya, Anda akan:
                // 1. Kirim pesan ke backend Santrilogy yang terhubung ke Google Generative AI
                // 2. Dapatkan respons dari AI
                // 3. Simpan respons ke database Supabase

                // Untuk saat ini, kita akan membuat panggilan ke endpoint backend
                // yang menangani integrasi dengan Google Generative AI
                const aiResponse = await callSantrilogyBackend(message, userId, sessionId);

                if (aiResponse.success) {
                    // Simpan respons AI ke database Supabase
                    const aiMessageResult = await SantrilogyAPI.chat.saveMessage(
                        sessionId,
                        userId,
                        'assistant',
                        aiResponse.text
                    );

                    if (!aiMessageResult.success) {
                        console.error('Error saving AI response:', aiMessageResult.error);
                    }

                    return {
                        success: true,
                        data: {
                            userMessage: userMessageResult.data,
                            aiResponse: aiResponse.text,
                            aiMessage: aiMessageResult.success ? aiMessageResult.data : null
                        }
                    };
                } else {
                    throw new Error(aiResponse.error || 'AI response failed');
                }
            } catch (error) {
                console.error('Send chat error:', error);
                return { success: false, error: error.message };
            }
        },

        // Ambil riwayat percakapan dari Supabase
        getHistory: async function(userId) {
            try {
                const result = await SantrilogyAPI.chat.getUserChatSessions(userId);
                if (!result.success) {
                    throw new Error(result.error);
                }

                // Format data untuk kompatibilitas
                const history = result.data.map(session => ({
                    id: session.id,
                    title: session.title,
                    timestamp: session.updated_at,
                    messageCount: session.messageCount || 0
                }));

                return { success: true, history };
            } catch (error) {
                console.error('Get history error:', error);
                return { success: false, history: [] };
            }
        },

        // Operasi sesi dengan Supabase
        sessionOp: async function(sessionId, userId, action, sessionData = null) {
            try {
                if (action === 'save' && sessionData) {
                    // Update atau buat sesi di Supabase
                    const { data: existingSession, error: fetchError } = await supabase
                        .from('chat_sessions')
                        .select('*')
                        .eq('id', sessionId)
                        .eq('user_id', userId)
                        .single();

                    if (fetchError && fetchError.code !== 'PGRST116') { // PGRST116 = Row not found
                        throw fetchError;
                    }

                    if (existingSession) {
                        // Update sesi yang sudah ada
                        const { error } = await supabase
                            .from('chat_sessions')
                            .update({
                                title: sessionData.title,
                                updated_at: new Date().toISOString()
                            })
                            .eq('id', sessionId)
                            .eq('user_id', userId);

                        if (error) throw error;
                    } else {
                        // Buat sesi baru
                        const { error } = await supabase
                            .from('chat_sessions')
                            .insert([{
                                id: sessionId,
                                user_id: userId,
                                title: sessionData.title,
                                metadata: { created_with: 'santrilogy-ai' }
                            }]);

                        if (error) throw error;
                    }

                    return { success: true };
                }
                else if (action === 'get') {
                    // Ambil sesi dari Supabase
                    const { data, error } = await supabase
                        .from('chat_sessions')
                        .select('*')
                        .eq('id', sessionId)
                        .eq('user_id', userId)
                        .single();

                    if (error) throw error;

                    return { success: true, data };
                }
                else if (action === 'delete') {
                    // Hapus sesi dari Supabase
                    const result = await SantrilogyAPI.chat.deleteChatSession(sessionId, userId);
                    return result;
                }

                return { success: false, error: 'Invalid action' };
            } catch (error) {
                console.error('Session operation error:', error);
                return { success: false, error: error.message };
            }
        },

        // Operasi autentikasi dengan Supabase
        authOp: async function(action, email = null, password = null, idToken = null) {
            try {
                if (action === 'login') {
                    if (!email || !password) {
                        return { success: false, error: 'Email and password required' };
                    }

                    const result = await SantrilogyAPI.auth.login(email, password);
                    return result;
                } else if (action === 'register') {
                    if (!email || !password) {
                        return { success: false, error: 'Email and password required' };
                    }

                    const result = await SantrilogyAPI.auth.register(email, password);
                    return result;
                } else if (action === 'logout') {
                    const result = await SantrilogyAPI.auth.logout();
                    return result;
                } else if (action === 'loginGoogle') {
                    const result = await SantrilogyAPI.auth.loginWithGoogle();
                    return result;
                }

                return { success: false, error: 'Invalid auth action' };
            } catch (error) {
                console.error('Auth operation error:', error);
                return { success: false, error: error.message };
            }
        }
    };

    // Fungsi untuk memanggil backend Santrilogy (menghubungkan ke Google Generative AI)
    async function callSantrilogyBackend(message, userId, sessionId) {
        try {
            // Dalam implementasi sebenarnya, ini akan menjadi panggilan ke backend API Anda
            // yang menangani integrasi dengan Google Generative AI

            // Contoh struktur respons untuk sementara
            const requestBody = {
                message: message,
                userId: userId,
                sessionId: sessionId,
                // Di sini Anda bisa menambahkan parameter lain yang diperlukan
                // oleh backend Santrilogy Anda
            };

            // Panggilan ke API backend (Anda perlu mengganti URL ini dengan endpoint backend Anda)
            const response = await fetch('/api/santrilogy-ai', { // Ganti dengan endpoint backend Anda
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestBody)
            });

            if (!response.ok) {
                throw new Error(`Backend API error: ${response.status}`);
            }

            const result = await response.json();

            return {
                success: true,
                text: result.response || result.text || 'Respons dari AI tidak ditemukan',
                // Tambahkan field lain sesuai kebutuhan dari respons backend
            };
        } catch (error) {
            console.error('Error calling Santrilogy backend:', error);
            return {
                success: false,
                error: error.message,
                text: `Maaf, terjadi kesalahan saat memproses permintaan Anda: ${error.message}`
            };
        }
    }

    // Wrapper fungsi-fungsi Supabase untuk kompatibilitas dengan main.js
    window.firebaseLoadHistory = async function() {
        const user = await SantrilogyAPI.auth.getCurrentUser();
        if (!user) return [];
        const result = await SantrilogyAPI.chat.getUserChatSessions(user.id);
        return result.success ? result.data : [];
    };

    window.firebaseSaveSession = async function(sessionId, userId, title, messages) {
        if (!sessionId || !userId) return false;
        const result = await SantrilogyBackend.sessionOp(sessionId, userId, 'save', { title, messages });
        return result.success;
    };

    window.firebaseLoadSession = async function(sessionId, userId) {
        if (!sessionId || !userId) return null;
        const result = await SantrilogyBackend.sessionOp(sessionId, userId, 'get');
        return result.success ? result.data : null;
    };

    window.firebaseDeleteSession = async function(sessionId, userId) {
        if (!sessionId || !userId) return false;
        const result = await SantrilogyAPI.chat.deleteChatSession(sessionId, userId);
        return result.success;
    };

    // Pastikan fungsi-fungsi ini tersedia sebelum main.js mencoba menggunakannya
    window.firebaseReady = true;
    //]]>
    </script>

    <!-- Load in proper dependency order from local repository -->
    <script src='/assets/js/santrilogy/utils.js'/>
    <script src='/assets/js/santrilogy/worker-integration.js'/>
    <script src='/assets/js/santrilogy/main.js'/>

    <!-- Santrilogy AI - Template Credit - Do Not Remove -->
    <script type='text/javascript'>
        //<![CDATA[
        (function() {
            'use strict';

            // Schedule the protection check to run after all external scripts have loaded
            window.addEventListener('load', function() {
                setTimeout(function() {
                    // Only check for credit removal - don't check for CDN-loaded scripts which may fail to load initially
                    var templateContent = document.documentElement.outerHTML;
                    if (!templateContent.includes('Santrilogy AI')) {
                        console.warn('Santrilogy AI credit has been removed. Redirecting to official site.');
                        window.location.href = 'https://www.lp.santrilogy.com';
                    }

                    // Check for essential DOM elements that are part of the template
                    var requiredElements = ['sidebar', 'messagesContainer', 'inputField', 'typingIndicator', 'authModal', 'settingsModal', 'feedbackModal'];
                    var missingElements = requiredElements.filter(function(elementId) {
                        return !document.getElementById(elementId);
                    });

                    // If critical template elements are missing (not just CDN scripts), redirect
                    if (missingElements.length > 3) { // Allow for some elements to not be loaded initially
                        console.warn('Critical Santrilogy AI template elements have been removed. Redirecting to official site.');
                        window.location.href = 'https://www.lp.santrilogy.com';
                    }

                    // Add non-removable credit notice
                    var creditNotice = document.createElement('div');
                    creditNotice.id = 'santrilogy-credit-notice';
                    creditNotice.style.cssText = 'position:fixed !important; bottom:0 !important; left:0 !important; width:100% !important; background:transparent !important; color:transparent !important; font-size:0 !important; line-height:0 !important; height:0 !important; overflow:hidden !important; z-index:-9999 !important; pointer-events:none !important;';
                    creditNotice.innerHTML = 'Template by Santrilogy AI - www.lp.santrilogy.com';
                    document.body.appendChild(creditNotice);
                }, 8000); // Check after 8 seconds to allow for all CDN resources to load
            });
        })();
        //]]>
    </script>

    <!-- Santrilogy - Custom Initialization Fix -->
    <script type='text/javascript'>
    //<![CDATA[
    (function() {
        'use strict';

        // Tunggu main.js dimuat, lalu pastikan elemen-elemen ditemukan sebelum inisialisasi
        function safeInitialize() {
            // Langsung coba cari elemen-elemen penting
            var elementsToFind = {
                'sidebar': document.getElementById('sidebar'),
                'messagesContainer': document.getElementById('messagesContainer'),
                'inputField': document.getElementById('inputField'),
                'sendBtn': document.getElementById('sendBtn'),
                'chatArea': document.getElementById('chatArea'),
                'mainHeader': document.getElementById('mainHeader'),
                'authModal': document.getElementById('authModal'),
                'settingsModal': document.getElementById('settingsModal'),
                'feedbackModal': document.getElementById('feedbackModal'),
                'quickPrompts': document.getElementById('quickPrompts'),
                'welcomeScreen': document.getElementById('welcomeScreen'),
                'historyList': document.getElementById('historyList'),
                'typingIndicator': document.getElementById('typingIndicator'),
                'userCard': document.getElementById('userCard'),
                'loginBtn': document.getElementById('loginBtn'),
                'settingsBtn': document.getElementById('settingsBtn'),
                'menuToggle': document.getElementById('menuToggle'),
                'newChatBtn': document.getElementById('newChatBtn')
            };

            // Update objek elements global agar main.js bisa menggunakannya
            if (typeof window !== 'undefined') {
                if (typeof window.elements === 'undefined') {
                    window.elements = {};
                }

                for (var key in elementsToFind) {
                    if (elementsToFind[key]) {
                        window.elements[key] = elementsToFind[key];
                    }
                }
            }

            // Cek apakah semua fungsi pengganti Cloudflare D1 + JWT siap
            var firebaseFunctionsReady = (
                typeof window.firebaseLoadHistory !== 'undefined' &&
                typeof window.firebaseSaveSession !== 'undefined' &&
                typeof window.firebaseLoadSession !== 'undefined' &&
                typeof window.firebaseDeleteSession !== 'undefined'
            );

            // Cek apakah SantrilogyApp sudah siap
            var appReady = typeof window.SantrilogyApp !== 'undefined';

            // Cek apakah elemen-elemen penting sudah siap
            var criticalElementsReady = !!(elementsToFind.sidebar &&
                                          elementsToFind.inputField &&
                                          elementsToFind.sendBtn &&
                                          elementsToFind.messagesContainer);

            if (firebaseFunctionsReady && criticalElementsReady) {
                console.log('Santrilogy: Semua dependensi siap, inisialisasi...');

                // Jalankan fungsi inisialisasi utama jika tersedia
                if (typeof window.init === 'function') {
                    try {
                        window.init();
                        console.log('Santrilogy: Inisialisasi utama selesai');
                    } catch (e) {
                        console.error('Santrilogy: Error saat inisialisasi:', e);
                    }
                } else {
                    // Jika fungsi init tidak ditemukan, panggil komponen utama satu per satu
                    try {
                        console.log('Santrilogy: Memanggil cacheElements...');
                        if (typeof window.cacheElements === 'function') {
                            window.cacheElements();
                            console.log('Santrilogy: cacheElements selesai');
                        }

                        console.log('Santrilogy: Memanggil initializeLibraries...');
                        if (typeof window.initializeLibraries === 'function') {
                            window.initializeLibraries();
                            console.log('Santrilogy: initializeLibraries selesai');
                        }

                        console.log('Santrilogy: Memanggil loadPreferences...');
                        if (typeof window.loadPreferences === 'function') {
                            window.loadPreferences();
                            console.log('Santrilogy: loadPreferences selesai');
                        }

                        console.log('Santrilogy: Memanggil setupEventListeners...');
                        if (typeof window.setupEventListeners === 'function') {
                            window.setupEventListeners();
                            console.log('Santrilogy: setupEventListeners selesai');
                        } else {
                            console.warn('Santrilogy: setupEventListeners tidak ditemukan');
                        }

                        console.log('Santrilogy: Memanggil setupFeedbackTimer...');
                        if (typeof window.setupFeedbackTimer === 'function') {
                            window.setupFeedbackTimer();
                            console.log('Santrilogy: setupFeedbackTimer selesai');
                        }

                        console.log('Santrilogy: Memanggil setupSmartHeader...');
                        if (typeof window.setupSmartHeader === 'function') {
                            window.setupSmartHeader();
                            console.log('Santrilogy: setupSmartHeader selesai');
                        }

                        // Pastikan UI user diupdate
                        console.log('Santrilogy: Memanggil updateUserUI...');
                        if (typeof window.updateUserUI === 'function') {
                            window.updateUserUI(null); // Tampilkan sebagai guest
                            console.log('Santrilogy: updateUserUI selesai');
                        }

                        console.log('Santrilogy: Inisialisasi komponen selesai');

                        // Menambahkan pengecekan tambahan untuk memastikan event listener terpasang
                        setTimeout(function() {
                            console.log('Santrilogy: Mengecek apakah event listener terpasang...');

                            // Cek apakah tombol-tombol utama memiliki event listener
                            var sendBtn = document.getElementById('sendBtn');
                            var menuToggle = document.getElementById('menuToggle');
                            var newChatBtn = document.getElementById('newChatBtn');
                            var settingsBtn = document.getElementById('settingsBtn');
                            var quickPrompts = document.getElementById('quickPrompts');

                            if (sendBtn) {
                                console.log('Santrilogy: Send button ditemukan, cek apakah bisa diklik...');
                                // Tambahkan event listener manual sebagai fallback
                                if (!sendBtn.getAttribute('data-listener-added')) {
                                    sendBtn.addEventListener('click', function() {
                                        if (typeof window.sendMessage === 'function') {
                                            window.sendMessage();
                                        } else {
                                            console.error('Santrilogy: Fungsi sendMessage tidak ditemukan');
                                        }
                                    });
                                    sendBtn.setAttribute('data-listener-added', 'true');
                                    console.log('Santrilogy: Fallback event listener ditambahkan ke sendBtn');
                                }
                            }

                            if (menuToggle && !menuToggle.getAttribute('data-listener-added')) {
                                menuToggle.addEventListener('click', function() {
                                    if (typeof window.toggleSidebar === 'function') {
                                        window.toggleSidebar(true);
                                    }
                                });
                                menuToggle.setAttribute('data-listener-added', 'true');
                                console.log('Santrilogy: Fallback event listener ditambahkan ke menuToggle');
                            }

                            if (newChatBtn && !newChatBtn.getAttribute('data-listener-added')) {
                                newChatBtn.addEventListener('click', function() {
                                    if (typeof window.startNewChat === 'function') {
                                        window.startNewChat();
                                    }
                                });
                                newChatBtn.setAttribute('data-listener-added', 'true');
                                console.log('Santrilogy: Fallback event listener ditambahkan ke newChatBtn');
                            }

                            if (settingsBtn && !settingsBtn.getAttribute('data-listener-added')) {
                                settingsBtn.addEventListener('click', function() {
                                    if (typeof window.SantrilogyApp !== 'undefined' && typeof window.SantrilogyApp.openModal === 'function') {
                                        window.SantrilogyApp.openModal('settingsModal');
                                    }
                                });
                                settingsBtn.setAttribute('data-listener-added', 'true');
                                console.log('Santrilogy: Fallback event listener ditambahkan ke settingsBtn');
                            }

                            if (quickPrompts && !quickPrompts.hasAttribute('data-listener-added')) {
                                quickPrompts.addEventListener('click', function(e) {
                                    var prompt = e.target.closest('.quick-prompt');
                                    if (prompt && prompt.dataset && prompt.dataset.prompt) {
                                        if (typeof window.usePrompt === 'function') {
                                            window.usePrompt(prompt.dataset.prompt);
                                        }
                                    }
                                });
                                quickPrompts.setAttribute('data-listener-added', 'true');
                                console.log('Santrilogy: Fallback event listener ditambahkan ke quickPrompts');
                            }
                        }, 1000); // Delay 1 detik untuk memastikan semuanya selesai

                        // Tambahkan pengecekan keberadaan fungsi-fungsi penting dan buat fallback jika perlu
                        setTimeout(function() {
                            console.log('Santrilogy: Mengecek keberadaan fungsi-fungsi penting...');

                            // Coba cari fungsi-fungsi penting dari objek SantrilogyApp jika tersedia
                            if (typeof window.SantrilogyApp !== 'undefined') {
                                console.log('Santrilogy: SantrilogyApp ditemukan, mencari fungsi-fungsi di dalamnya...');

                                // Ekspos fungsi-fungsi dari SantrilogyApp ke window jika belum ada
                                if (typeof window.sendMessage !== 'function' && typeof window.SantrilogyApp.sendMessage === 'function') {
                                    window.sendMessage = window.SantrilogyApp.sendMessage;
                                    console.log('Santrilogy: Fungsi sendMessage diambil dari SantrilogyApp');
                                }

                                if (typeof window.startNewChat !== 'function' && typeof window.SantrilogyApp.startNewChat === 'function') {
                                    window.startNewChat = window.SantrilogyApp.startNewChat;
                                    console.log('Santrilogy: Fungsi startNewChat diambil dari SantrilogyApp');
                                }

                                if (typeof window.usePrompt !== 'function' && typeof window.SantrilogyApp.usePrompt === 'function') {
                                    window.usePrompt = window.SantrilogyApp.usePrompt;
                                    console.log('Santrilogy: Fungsi usePrompt diambil dari SantrilogyApp');
                                }

                                // Cek semua fungsi dari SantrilogyApp dan ekspos ke window
                                for (var key in window.SantrilogyApp) {
                                    if (typeof window.SantrilogyApp[key] === 'function' && typeof window[key] !== 'function') {
                                        window[key] = window.SantrilogyApp[key];
                                        console.log('Santrilogy: Fungsi ' + key + ' diambil dari SantrilogyApp dan diekspos');
                                    }
                                }
                            }

                            // Cek apakah state tersedia dan coba ekspos fungsinya
                            if (typeof window.state !== 'undefined') {
                                console.log('Santrilogy: Objek state ditemukan');
                                // Coba akses fungsi-fungsi dari dalam objek state jika mereka adalah fungsi
                                if (typeof window.state.sendMessage === 'function') {
                                    window.sendMessage = window.state.sendMessage;
                                    console.log('Santrilogy: Fungsi sendMessage diambil dari state');
                                }
                            }

                            // Cek dan buat fallback untuk fungsi-fungsi penting jika tidak ditemukan
                            var functionsToCheck = [
                                'sendMessage', 'startNewChat', 'toggleSidebar', 'usePrompt',
                                'handleInput', 'showToast', 'openModal', 'closeModal', 'loadChatHistory'
                            ];

                            functionsToCheck.forEach(function(funcName) {
                                if (typeof window[funcName] !== 'function') {
                                    // Jika fungsi tidak ditemukan di mana pun, buat fallback
                                    window[funcName] = function() {
                                        console.error('Santrilogy: Fungsi ' + funcName + ' tidak ditemukan di mana pun, fallback diaktifkan');
                                        if (funcName === 'showToast' && arguments.length > 0) {
                                            console.log('Santrilogy: Toast message -', arguments[0]);
                                        } else if (funcName === 'sendMessage') {
                                            // Fallback khusus untuk sendMessage
                                            var inputField = document.getElementById('inputField');
                                            if (inputField) {
                                                var text = inputField.value.trim();
                                                if (text) {
                                                    console.log('Santrilogy: Mengirim pesan fallback:', text);
                                                    // Tampilkan pesan error bahwa fungsi utama tidak berfungsi
                                                    if (typeof window.showToast === 'function') {
                                                        window.showToast('Fungsi kirim pesan utama belum siap', 'error');
                                                    }
                                                }
                                            }
                                        }
                                    };
                                    console.log('Santrilogy: Fallback ' + funcName + ' ditambahkan');
                                } else {
                                    console.log('Santrilogy: Fungsi ' + funcName + ' ditemukan dan siap digunakan');
                                }
                            });

                            // Sekarang coba jalankan setupEventListeners jika tersedia
                            if (typeof window.setupEventListeners === 'function') {
                                console.log('Santrilogy: Menjalankan setupEventListeners...');
                                try {
                                    window.setupEventListeners();
                                    console.log('Santrilogy: setupEventListeners berhasil dijalankan');
                                } catch (e) {
                                    console.error('Santrilogy: Error saat menjalankan setupEventListeners:', e);
                                }
                            } else {
                                console.warn('Santrilogy: setupEventListeners tidak tersedia, pasangkan manual');

                                // Cek apakah inputField memiliki event listener
                                var inputField = document.getElementById('inputField');
                                if (inputField && !inputField.getAttribute('data-input-listener-added')) {
                                    // Setup event listener untuk input field
                                    inputField.addEventListener('input', function() {
                                        if (typeof window.handleInput === 'function') {
                                            window.handleInput();
                                        }
                                    });

                                    inputField.addEventListener('keydown', function(e) {
                                        if (e.key === 'Enter' && !e.shiftKey) {
                                            e.preventDefault();
                                            if (typeof window.sendMessage === 'function') {
                                                window.sendMessage();
                                            }
                                        }
                                    });

                                    inputField.setAttribute('data-input-listener-added', 'true');
                                    console.log('Santrilogy: Input event listener ditambahkan');
                                }

                                // Cek tombol-tombol UI dan pasangkan event listener jika belum ada
                                var buttonsToCheck = [
                                    { id: 'sendBtn', action: 'sendMessage' },
                                    { id: 'menuToggle', action: 'toggleSidebar' },
                                    { id: 'newChatBtn', action: 'startNewChat' },
                                    { id: 'settingsBtn', action: function() {
                                        if (typeof window.SantrilogyApp !== 'undefined' && typeof window.SantrilogyApp.openModal === 'function') {
                                            window.SantrilogyApp.openModal('settingsModal');
                                        } else if (typeof window.openModal === 'function') {
                                            window.openModal('settingsModal');
                                        }
                                    }}
                                ];

                                buttonsToCheck.forEach(function(btnInfo) {
                                    var element = document.getElementById(btnInfo.id);
                                    if (element && !element.getAttribute('data-listener-added')) {
                                        if (typeof btnInfo.action === 'string') {
                                            // Action adalah nama fungsi
                                            element.addEventListener('click', function() {
                                                if (typeof window[btnInfo.action] === 'function') {
                                                    window[btnInfo.action]();
                                                } else {
                                                    console.error('Santrilogy: Fungsi ' + btnInfo.action + ' tidak ditemukan untuk tombol ' + btnInfo.id);
                                                }
                                            });
                                        } else if (typeof btnInfo.action === 'function') {
                                            // Action adalah fungsi langsung
                                            element.addEventListener('click', btnInfo.action);
                                        }

                                        element.setAttribute('data-listener-added', 'true');
                                        console.log('Santrilogy: Event listener ditambahkan ke ' + btnInfo.id);
                                    }
                                });
                            }

                            console.log('Santrilogy: Pengecekan fungsi-fungsi penting selesai');
                        }, 1500); // Delay 1.5 detik untuk memberi waktu lebih
                    } catch (e) {
                        console.error('Santrilogy: Error saat inisialisasi komponen:', e);
                    }
                }
            } else {
                console.log('Santrilogy: Menunggu dependensi...', {
                    firebaseReady: firebaseFunctionsReady,
                    elementsReady: criticalElementsReady,
                    appReady: appReady
                });

                // Coba lagi setelah delay
                setTimeout(safeInitialize, 200);
            }
        }

        // Mulai proses inisialisasi
        if (document.readyState === 'complete' || document.readyState === 'interactive') {
            // Jika DOM sudah siap, mulai sekarang
            setTimeout(safeInitialize, 100);
        } else {
            // Tunggu DOM siap
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(safeInitialize, 100);
            });
        }
    })();
    //]]>
    </script>

    <!-- Additional Event Listeners for ChatGPT-like UI -->
    <script type='text/javascript'>
    //<![CDATA[
    (function() {
        'use strict';

        // Wait for DOM to be fully loaded and elements to be available
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                setupHeaderButtonListener();
            });
        } else {
            // If DOM is already loaded, set up immediately
            setTimeout(setupHeaderButtonListener, 100);
        }

        function setupHeaderButtonListener() {
            // Try to get the new chat button in header
            var newChatBtnHeader = document.getElementById('newChatBtnHeader');
            if (newChatBtnHeader) {
                // Add click event to start new chat
                newChatBtnHeader.addEventListener('click', function() {
                    if (typeof startNewChat === 'function') {
                        startNewChat();
                    } else if (typeof window.SantrilogyApp !== 'undefined' && typeof window.SantrilogyApp.startNewChat === 'function') {
                        window.SantrilogyApp.startNewChat();
                    } else {
                        // Fallback: try to find and click the sidebar button
                        var sidebarNewChatBtn = document.getElementById('newChatBtn');
                        if (sidebarNewChatBtn) {
                            sidebarNewChatBtn.click();
                        } else {
                            console.log('Could not find new chat button to trigger');
                        }
                    }
                });
                console.log('Added event listener for new chat header button');
            } else {
                console.log('Could not find new chat header button, retrying in 500ms');
                setTimeout(setupHeaderButtonListener, 500);
            }
        }
    })();
    //]]>
    </script>

    <!-- Santrilogy AI Debug Authentication Script -->
    <script>
    //<![CDATA[
    // ========== DEBUG AUTHENTICATION SYSTEM ==========
    // Ini adalah versi khusus untuk debugging masalah autentikasi

    console.log('Santrilogy AI: Loading debug authentication system...');

    // Fungsi untuk mengecek status kesiapan auth sistem
    function checkAuthSystemStatus() {
        const status = {
            firebaseEmailAuth: typeof window.firebaseEmailAuth === 'function',
            firebaseGoogleAuth: typeof window.firebaseGoogleAuth === 'function',
            firebaseLogout: typeof window.firebaseLogout === 'function',
            firebaseLoadHistory: typeof window.firebaseLoadHistory === 'function',
            firebaseSaveSession: typeof window.firebaseSaveSession === 'function',
            firebaseLoadSession: typeof window.firebaseLoadSession === 'function',
            firebaseDeleteSession: typeof window.firebaseDeleteSession === 'function',
            santrilogyAppAvailable: typeof window.SantrilogyApp !== 'undefined',
            elementsAvailable: document.getElementById('authModal') !== null
        };

        console.log('Auth System Status:', status);
        return status;
    }

    // Override fungsi-fungsi fallback untuk memberikan informasi debug
    if (typeof window.firebaseEmailAuth !== 'function' ||
        window.firebaseEmailAuth.toString().includes('not ready yet')) {

        console.log('Reinitializing firebaseEmailAuth function with Supabase...');

        window.firebaseEmailAuth = async function(email, password, authMode) {
            console.log('firebaseEmailAuth called with Supabase:', {email, authMode});
            console.log('Current auth system status:', checkAuthSystemStatus());

            try {
                let response;

                if (authMode === 'register') {
                    // Registrasi pengguna baru dengan Supabase
                    response = await SantrilogyBackend.authOp('register', email, password);
                } else {
                    // Login pengguna dengan Supabase
                    response = await SantrilogyBackend.authOp('login', email, password);
                }

                if (response.success) {
                    if (window.SantrilogyApp && typeof window.SantrilogyApp.updateUserUI === 'function') {
                        // Dapatkan user info dari Supabase
                        const user = await SantrilogyAPI.auth.getCurrentUser();

                        window.SantrilogyApp.updateUserUI(user || {
                            id: response.data?.user?.id || 'user_' + Date.now(),
                            email: email,
                            user_name: email.split('@')[0]
                        });

                        if (typeof window.SantrilogyApp.closeModal === 'function') {
                            window.SantrilogyApp.closeModal('authModal');
                        }

                        if (typeof window.SantrilogyApp.showToast === 'function') {
                            const successMsg = authMode === 'register' ? "Akun berhasil dibuat! " : "Selamat datang kembali! ";
                            window.SantrilogyApp.showToast(successMsg, "success");
                        }
                    }

                    return response;
                } else {
                    throw new Error(response.error || 'Authentication failed');
                }
            } catch (error) {
                console.error('Supabase authentication error:', error);
                if (window.SantrilogyApp && typeof window.SantrilogyApp.showToast === 'function') {
                    window.SantrilogyApp.showToast(error.message || 'Gagal melakukan autentikasi', 'error');
                }
                throw error;
            }
        };
    }

    // Ulangi untuk fungsi auth lainnya
    if (typeof window.firebaseGoogleAuth !== 'function' ||
        window.firebaseGoogleAuth.toString().includes('not ready yet')) {

        console.log('Reinitializing firebaseGoogleAuth function with Supabase...');

        window.firebaseGoogleAuth = async function() {
            console.log('firebaseGoogleAuth called with Supabase');
            console.log('Current auth system status:', checkAuthSystemStatus());

            try {
                // Login dengan Google menggunakan Supabase
                const response = await SantrilogyBackend.authOp('loginGoogle');

                if (response.success) {
                    if (window.SantrilogyApp && typeof window.SantrilogyApp.showToast === 'function') {
                        window.SantrilogyApp.showToast("Berhasil masuk dengan Google! ", "success");
                    }
                    return response;
                } else {
                    throw new Error(response.error || 'Google authentication failed');
                }
            } catch (error) {
                console.error('Supabase Google auth error:', error);
                if (window.SantrilogyApp && typeof window.SantrilogyApp.showToast === 'function') {
                    window.SantrilogyApp.showToast(error.message || 'Gagal masuk dengan Google', 'error');
                }
                throw error;
            }
        };
    }

    if (typeof window.firebaseLogout !== 'function' ||
        window.firebaseLogout.toString().includes('not ready yet')) {

        console.log('Reinitializing firebaseLogout function with Supabase...');

        window.firebaseLogout = async function() {
            console.log('firebaseLogout called with Supabase');

            try {
                // Logout dari Supabase
                const response = await SantrilogyBackend.authOp('logout');

                if (response.success) {
                    // Hapus data auth dari localStorage
                    localStorage.removeItem('santrilogy_user');
                    localStorage.removeItem('santrilogy_user_email');
                    localStorage.removeItem('santrilogy_user_hash');
                    localStorage.removeItem('santrilogy_id_token');
                    localStorage.removeItem('santrilogy_refresh_token');

                    if (window.SantrilogyApp && typeof window.SantrilogyApp.updateUserUI === 'function') {
                        window.SantrilogyApp.updateUserUI(null);
                        if (typeof window.SantrilogyApp.showToast === 'function') {
                            window.SantrilogyApp.showToast("Berhasil logout! ", "success");
                        }
                    }

                    return response;
                } else {
                    throw new Error(response.error || 'Logout failed');
                }
            } catch (error) {
                console.error('Supabase logout error:', error);
                if (window.SantrilogyApp && typeof window.SantrilogyApp.showToast === 'function') {
                    window.SantrilogyApp.showToast(error.message || 'Gagal logout', 'error');
                }
                throw error;
            }
        };
    }

    // Tambahkan fungsi untuk debugging
    window.testWorkerConnection = async function() {
        try {
            console.log('Testing worker connection...');
            const response = await fetch('https://santrilogy-ai.santrilogyapp.workers.dev/health');
            const data = await response.json();
            console.log('Worker connection successful:', data);
            return true;
        } catch (error) {
            console.error('Worker connection failed:', error);
            return false;
        }
    };

    // Jalankan pengecekan status saat diinisialisasi
    setTimeout(() => {
        console.log('=== Santrilogy AI Authentication Debug ===');
        checkAuthSystemStatus();

        // Coba test connection
        window.testWorkerConnection();
    }, 1000);

    // Tandai bahwa sistem debug sudah dimuat
    window.authDebugReady = true;
    console.log('Santrilogy AI: Debug authentication system loaded');
    //]]>
    </script>
<!-- Report Modal -->
    <div class="modal-overlay" id="reportModal">
        <div class="modal">
            <button class="modal-close" id="reportModalClose"></button>
            <div class="modal-header">
                <div class="modal-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 9v4m0 4h.01M5.072 5.072a7 7 0 1 1 9.856 9.856 7 7 0 0 1-9.856-9.856z"/>
                    </svg>
                </div>
                <h3 class="modal-title">Laporkan Pesan</h3>
                <p class="modal-subtitle">Bantu kami meningkatkan kualitas layanan</p>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="reportReason">Alasan Pelaporan</label>
                    <select class="form-select" id="reportReason">
                        <option value="">Pilih alasan...</option>
                        <option value="inappropriate">Konten tidak pantas</option>
                        <option value="inaccurate">Informasi tidak akurat</option>
                        <option value="harmful">Konten berbahaya</option>
                        <option value="spam">Spam atau iklan</option>
                        <option value="other">Lainnya</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="reportMessage">Detail (Opsional)</label>
                    <textarea class="form-textarea" id="reportMessage" rows="4" placeholder="Jelaskan lebih lanjut tentang pesan yang ingin Anda laporkan..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelReportBtn">Batal</button>
                <button class="btn-primary" id="submitReportBtn">Kirim Laporan</button>
            </div>
        </div>
    </div>

    <script type='text/javascript'>
    <!--
    (function() {
        'use strict';

        // Setup report modal functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Report modal elements
            var reportModal = document.getElementById('reportModal');
            var reportModalClose = document.getElementById('reportModalClose');
            var cancelReportBtn = document.getElementById('cancelReportBtn');
            var submitReportBtn = document.getElementById('submitReportBtn');
            var reportReason = document.getElementById('reportReason');
            var reportMessage = document.getElementById('reportMessage');

            // Close modal functions
            function closeModal() {
                reportModal.classList.remove('active');
                // Reset form
                reportReason.value = '';
                reportMessage.value = '';
            }

            if (reportModalClose) {
                reportModalClose.addEventListener('click', closeModal);
            }

            if (cancelReportBtn) {
                cancelReportBtn.addEventListener('click', closeModal);
            }

            // Submit report function
            if (submitReportBtn) {
                submitReportBtn.addEventListener('click', function() {
                    var selectedReason = reportReason.value;
                    var additionalMessage = reportMessage.value.trim();

                    if (!selectedReason) {
                        if (window.SantrilogyApp && typeof window.SantrilogyApp.showToast === 'function') {
                            window.SantrilogyApp.showToast('Silakan pilih alasan pelaporan', 'error');
                        } else {
                            alert('Silakan pilih alasan pelaporan');
                        }
                        return;
                    }

                    // Create mailto link with pre-filled information
                    var subject = encodeURIComponent('Laporan Pesan dari Santrilogy AI');
                    var body = encodeURIComponent(
                        'Alasan Pelaporan: ' + selectedReason + '\n' +
                        'Detail Tambahan: ' + (additionalMessage || 'Tidak ada detail tambahan') + '\n\n' +
                        'Mohon tinjau pesan yang dilaporkan sesegera mungkin.'
                    );

                    var mailtoLink = 'mailto:santrilogyapp@gmail.com?subject=' + subject + '&body=' + body;

                    // Open email client
                    window.location.href = mailtoLink;

                    // Show success message and close modal
                    if (window.SantrilogyApp && typeof window.SantrilogyApp.showToast === 'function') {
                        window.SantrilogyApp.showToast('Laporan akan dikirim melalui email', 'success');
                    } else {
                        alert('Laporan akan dikirim melalui email');
                    }

                    closeModal();
                });
            }

            // Add global function to open report modal
            if (typeof window.SantrilogyApp === 'undefined') {
                window.SantrilogyApp = {};
            }

            window.SantrilogyApp.openReportModal = function() {
                reportModal.style.display = 'flex';
                setTimeout(function() {
                    reportModal.classList.add('active');
                }, 10);
            };
        });
    })();
    -->
    </script>

    <!-- Supabase Connection Test -->
    <script>
        //<![CDATA[
        // Test koneksi Supabase saat halaman dimuat
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Testing Supabase connection...');

            // Fungsi untuk menguji koneksi Supabase
            window.testSupabaseConnection = async function() {
                try {
                    // Coba ambil informasi pengguna saat ini
                    const user = await SantrilogyAPI.auth.getCurrentUser();

                    if (user) {
                        console.log(' Supabase connection successful, user authenticated:', user.email);
                        return { success: true, user: user };
                    } else {
                        console.log(' Supabase connection successful, no user authenticated');
                        return { success: true, user: null };
                    }
                } catch (error) {
                    console.error(' Supabase connection failed:', error.message);
                    return { success: false, error: error.message };
                }
            };

            // Jalankan test koneksi
            const connectionResult = await window.testSupabaseConnection();

            // Tandai bahwa Supabase siap digunakan
            window.supabaseReady = connectionResult.success;

            // Tambahkan status koneksi ke objek global untuk debugging
            window.santrilogyStatus = {
                supabaseReady: connectionResult.success,
                user: connectionResult.user || null,
                timestamp: new Date().toISOString()
            };

            console.log('Santrilogy AI Status:', window.santrilogyStatus);
        });
        //]]>
    </script>

    <!-- Section wajib Blogger -->
    <b:section class='main' id='main' maxwidgets='1' showaddelement='no'/>

</body>
</html>